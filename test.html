<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Grade [X] Weekly Tech Lesson</title>
  <style>
    body {
      font-family: 'Comic Sans MS', Arial, Helvetica, sans-serif;
      background: url('./pictures/otherIcons/backgroundJungle.png') no-repeat center center fixed;
      background-size: cover;
      color: #2e3d2f;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
      background-color: rgba(255, 255, 255, 0.8);
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 6px 12px rgba(0,0,0,0.2);
    }

    header .title-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 28px; /* wider gap for bigger pics */
      flex-wrap: wrap;
    }

    /* Bigger header images + responsive fallback */
    header img { width: 120px; height: 120px; }
    @media (max-width: 520px) {
      header img { width: 80px; height: 80px; }
    }

    header h1 { font-size: 2.5em; color: #2e3d2f; margin: 0; }
    header h3 { color: #4f6f52; font-weight: normal; margin-top: 10px; }

    section {
      background-color: rgba(255, 255, 255, 0.9);
      border-radius: 12px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
      padding: 20px;
      margin-bottom: 10px;
    }

    h2 { color: #4f6f52; margin-bottom: 10px; }

    .button, button {
      display: inline-block;
      background-color: #7c9a63;
      color: white;
      padding: 10px 15px;
      text-decoration: none;
      border-radius: 6px;
      margin-top: 10px;
      transition: background-color 0.3s ease;
      border: none;
      cursor: pointer;
      font-family: inherit;
    }
    .button:hover, button:hover { background-color: #65804f; }
    .button[disabled], button[disabled] { opacity: 0.5; cursor: not-allowed; }

    .objectives { display: flex; justify-content: space-between; flex-wrap: wrap; }
    .objectives div { flex: 1; min-width: 250px; padding-right: 10px; }

    .divider-icon { text-align: center; }
    .divider-icon img { width: 25%; height: 25%; }

    a img:hover { transform: scale(1.05); transition: transform 0.2s; }

    /* ===== Top controls (timer toggle) ===== */
    .top-controls {
      display: flex;
      align-items: center;
      gap: 12px;
      justify-content: flex-end;
      margin-bottom: -8px;
    }
    .toggle {
      display: inline-flex; align-items: center; gap: 6px;
      background: rgba(255,255,255,0.9);
      border: 1px solid #e6eddc; border-radius: 8px; padding: 6px 10px;
    }

    /* ===== Numbered task list (Must Do) ===== */
    ol.tasks { list-style: none; counter-reset: step; margin: 0; padding: 0; }
    ol.tasks > li {
      counter-increment: step;
      position: relative;
      padding: 12px 12px 12px 44px;
      border: 1px solid #e6eddc;
      border-radius: 10px;
      background: rgba(255,255,255,0.9);
      margin: 12px 0;
      display: flex; align-items: center; gap: 12px;
    }
    ol.tasks > li::before {
      content: counter(step) ".";
      position: absolute; left: 14px; top: 50%; transform: translateY(-50%);
      font-weight: bold; color: #4f6f52; font-size: 1.1rem;
    }
    .task-label { flex: 1 1 auto; color: #2e3d2f; }
    .task-status {
      width: 28px; height: 28px; border-radius: 50%;
      border: 2px solid #7c9a63; display: inline-flex;
      align-items: center; justify-content: center; font-weight: 700; user-select: none;
    }
    li.completed .task-label { text-decoration: line-through; opacity: 0.6; }
    li.completed .task-status { background: #7c9a63; color: #fff; border-color: #7c9a63; }
    li.completed button { pointer-events: none; opacity: 0.6; }

    /* ===== Modal (Full-Screen) ===== */
    .modal {
      display: none; position: fixed; z-index: 1000; inset: 0;
      width: 100vw; height: 100vh; background-color: rgba(0,0,0,0.6);
    }
    .modal-content {
      position: absolute; inset: 0; background-color: #fefefe;
      border: 2px solid #7c9a63; border-radius: 0; box-shadow: 0 10px 25px rgba(0,0,0,0.3);
      display: flex; flex-direction: column; box-sizing: border-box;
    }
    .modal-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 12px 18px; border-bottom: 1px solid #e2e2e2; background: #ffffff;
      gap: 12px;
    }
    .modal-header h3 { margin: 0; color: #2e3d2f; }
    .close {
      color: #333; font-size: 28px; font-weight: bold; cursor: pointer; line-height: 1;
      padding: 4px 10px; border-radius: 6px;
    }
    .close:hover { background: #f0f0f0; }

    .modal-body { flex: 1 1 auto; display: flex; min-height: 0; }
    .modal-body iframe { width: 100%; height: 100%; border: 0; }

    /* Timer bar */
    .timer-wrap { flex: 0 0 auto; width: 210px; }
    .timer-label { font-size: 0.8rem; color: #4f6f52; }
    .timer-bar {
      width: 100%; height: 8px; background: #e6eddc; border-radius: 6px; overflow: hidden;
    }
    .timer-fill {
      height: 100%; width: 0%; background: #7c9a63; transition: width 1s linear;
    }
  </style>
</head>
<body>

  <header>
    <div class="title-row">
      <img src="./pictures/lionClipArt/lionBook.png" alt="Lion Icon 1" />
      <h1>Grade [X] Weekly Tech Lesson</h1>
      <img src="./pictures/lionClipArt/lionLaptop.png" alt="Lion Icon 2" />
    </div>
    <h3>[Insert Weekly Theme or Topic Here]</h3>
  </header>

  <!-- Timer toggle -->
  <div class="top-controls">
    <label class="toggle">
      <input type="checkbox" id="timerToggle" checked>
      <span>‚è± Timers: On</span>
    </label>
  </div>

  <section>
    <h2>üéØ Objectives</h2>
    <div class="objectives">
      <div>
        <strong>I Can Statements:</strong>
        <ul>
          <li>I can [skill statement #1].</li>
          <li>I can [skill statement #2].</li>
        </ul>
      </div>
      <div>
        <strong>Standards:</strong>
        <ul>
          <li>ISTE 1.1.b ‚Äì Empowered Learner</li>
          <li>AISLE 1B.1.3 ‚Äì Demonstrate responsible use of technology</li>
        </ul>
      </div>
    </div>
  </section>

  <div class="divider-icon"><img src="./pictures/otherIcons/divderArrows.png" alt="Down Arrow Divider" /></div>

  <section>
    <h2>üì¢ Reminders</h2>
    <p>Watch the screencast below. You can pause or rewatch if needed!</p>
    <iframe width="100%" height="315" src="[PASTE_YOUR_VIDEO_LINK_HERE]" frameborder="0" allowfullscreen></iframe>
  </section>

  <div class="divider-icon"><img src="./pictures/otherIcons/divderArrows.png" alt="Down Arrow Divider" /></div>

  <section>
    <h2>üìå Must Do</h2>
    <!-- Enforced order: 1 Typing ‚Üí 2 Checkout ‚Üí 3 Instructions ‚Üí 4 Activity ‚Üí 5 Works of Choice -->
    <ol class="tasks" id="taskList">
      <li id="task-1" data-modal="modal1">
        <span class="task-status">‚úì</span>
        <span class="task-label">Typing Warm-Up</span>
        <button id="btn-task-1" onclick="openModalFromTask('task-1')">Open</button>
      </li>
      <li id="task-2" data-modal="modal4">
        <span class="task-status">‚úì</span>
        <span class="task-label">üìö Book Checkout ‚Äì Choose 1‚Äì2 books, then come back and mark done</span>
        <button id="btn-task-2" onclick="openModalFromTask('task-2')" disabled>Open</button>
      </li>
      <li id="task-3" data-modal="modal2">
        <span class="task-status">‚úì</span>
        <span class="task-label">Instructions ‚Äì Watch and confirm you understand</span>
        <button id="btn-task-3" onclick="openModalFromTask('task-3')" disabled>Open</button>
      </li>
      <li id="task-4" data-modal="modal3">
        <span class="task-status">‚úì</span>
        <span class="task-label">Main Activity</span>
        <button id="btn-task-4" onclick="openModalFromTask('task-4')" disabled>Open</button>
      </li>
      <li id="task-5" data-modal="modal5">
        <span class="task-status">‚úì</span>
        <span class="task-label">üéâ Works of Choice</span>
        <button id="btn-task-5" onclick="openModalFromTask('task-5')" disabled>Open</button>
      </li>
    </ol>
  </section>

  <!-- Modals -->
  <!-- 1) Typing -->
  <div id="modal1" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal1-title" data-duration="300">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal1-title">Typing Warm-Up</h3>
        <div class="timer-wrap">
          <div class="timer-label"><span id="time-modal1">5:00</span></div>
          <div class="timer-bar"><div id="bar-modal1" class="timer-fill"></div></div>
        </div>
        <span class="close" onclick="closeModal('modal1')" aria-label="Close">&times;</span>
      </div>
      <div class="modal-body">
        <iframe src="./typingWarmUp.html"></iframe>
      </div>
    </div>
  </div>

  <!-- 2) Book Checkout -->
  <div id="modal4" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal4-title" data-duration="420">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal4-title">üìö Book Checkout</h3>
        <div class="timer-wrap">
          <div class="timer-label"><span id="time-modal4">7:00</span></div>
          <div class="timer-bar"><div id="bar-modal4" class="timer-fill"></div></div>
        </div>
        <span class="close" onclick="closeModal('modal4')" aria-label="Close">&times;</span>
      </div>
      <div class="modal-body" style="flex-direction:column; padding:16px; gap:16px;">
        <div style="font-size:1.05rem; line-height:1.5;">
          <ol>
            <li>Quietly choose <strong>1‚Äì2 books</strong> you‚Äôre excited to read.</li>
            <li>Use <em>Destiny Discover</em> if you need help finding a book.</li>
            <li>Treat books with care and check out at the desk.</li>
          </ol>
          <p>When you‚Äôre back at your seat, click the button below:</p>
        </div>
        <button onclick="completeTaskFromModal('task-2','modal4')">I‚Äôm done‚Äîbooks checked out!</button>
      </div>
    </div>
  </div>

  <!-- 3) Instructions -->
  <div id="modal2" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal2-title" data-duration="180">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal2-title">Instructions</h3>
        <div class="timer-wrap">
          <div class="timer-label"><span id="time-modal2">3:00</span></div>
          <div class="timer-bar"><div id="bar-modal2" class="timer-fill"></div></div>
        </div>
        <span class="close" onclick="closeModal('modal2')" aria-label="Close">&times;</span>
      </div>
      <div class="modal-body" style="flex-direction:column; padding:16px; gap:16px;">
        <div style="font-size:1.05rem; line-height:1.5;">
          <p><strong>Watch this quick guide, then click ‚ÄúI‚Äôm ready‚Äù.</strong></p>
        </div>
        <iframe src="[PASTE_YOUR_VIDEO_LINK_HERE]"></iframe>
        <div style="padding:12px 0 0;">
          <button onclick="completeTaskFromModal('task-3','modal2')">I‚Äôm ready ‚Äî I understand</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 4) Main Activity -->
  <div id="modal3" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal3-title" data-duration="900">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal3-title">Main Activity</h3>
        <div class="timer-wrap">
          <div class="timer-label"><span id="time-modal3">15:00</span></div>
          <div class="timer-bar"><div id="bar-modal3" class="timer-fill"></div></div>
        </div>
        <span class="close" onclick="closeModal('modal3')" aria-label="Close">&times;</span>
      </div>
      <div class="modal-body">
        <iframe src="[ACTIVITY_URL]"></iframe>
      </div>
    </div>
  </div>

  <!-- 5) Works of Choice -->
  <div id="modal5" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal5-title" data-duration="600">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal5-title">üéâ Works of Choice</h3>
        <div class="timer-wrap">
          <div class="timer-label"><span id="time-modal5">10:00</span></div>
          <div class="timer-bar"><div id="bar-modal5" class="timer-fill"></div></div>
        </div>
        <span class="close" onclick="closeModal('modal5')" aria-label="Close">&times;</span>
      </div>
      <div class="modal-body" style="flex-direction:column; padding:16px; gap:16px;">
        <p>Pick an activity from the Works of Choice board! üé®üéÆüìñ</p>
        <a href="[CHOICE_BOARD_LINK]" target="_blank">
          <img src="./pictures/otherIcons/worksChoice.png" alt="Works of Choice" style="max-width:320px; margin:auto; display:block;">
        </a>
        <div style="text-align:center;">
          <button onclick="completeTaskFromModal('task-5','modal5')">I‚Äôm done with Works of Choice</button>
        </div>
      </div>
    </div>
  </div>

  <div class="divider-icon"><img src="./pictures/otherIcons/FooterJungleAnimal.png" alt="Down Arrow Divider" /></div>



  <script>
    // ===== Config =====
    const AUTO_COMPLETE_ON_TIMEOUT = false; // set true to auto-complete when timers end

    // ===== State / helpers =====
    function markCompleted(taskId) {
      const li = document.getElementById(taskId);
      if (li) li.classList.add('completed');
      updateTaskLocks();
    }

    function isCompleted(taskId) {
      const li = document.getElementById(taskId);
      return li && li.classList.contains('completed');
    }

    function updateTaskLocks() {
      // enforce order: 1 -> 2 -> 3 -> 4 -> 5
      setEnabled('btn-task-1', true);
      setEnabled('btn-task-2', isCompleted('task-1'));
      setEnabled('btn-task-3', isCompleted('task-2'));
      setEnabled('btn-task-4', isCompleted('task-3'));
      setEnabled('btn-task-5', isCompleted('task-4'));
    }

    function setEnabled(btnId, enabled) {
      const btn = document.getElementById(btnId);
      if (!btn) return;
      if (enabled) btn.removeAttribute('disabled');
      else btn.setAttribute('disabled', 'disabled');
    }

    // ===== Timer logic per modal =====
    const timers = {}; // modalId -> {interval, remaining, total}

    function formatTime(s) {
      s = Math.max(0, Math.floor(s));
      const m = Math.floor(s / 60);
      const sec = s % 60;
      return `${m}:${sec.toString().padStart(2, '0')}`;
    }

    function startTimer(modalId) {
      const toggle = document.getElementById('timerToggle');
      const useTimers = toggle && toggle.checked;
      const modal = document.getElementById(modalId);
      if (!modal) return;

      const total = Number(modal.getAttribute('data-duration') || 0);
      const timeEl = document.getElementById(`time-${modalId}`);
      const barEl = document.getElementById(`bar-${modalId}`);

      // If timers off or no duration, clear visuals and exit
      if (!useTimers || !total || !timeEl || !barEl) {
        if (timeEl) timeEl.textContent = '';
        if (barEl) barEl.style.width = '0%';
        return;
      }

      // init
      if (timers[modalId]) clearInterval(timers[modalId].interval);
      timers[modalId] = { remaining: total, total, interval: null };

      // draw initial
      timeEl.textContent = formatTime(total);
      barEl.style.width = '0%';

      timers[modalId].interval = setInterval(() => {
        const t = timers[modalId];
        if (!t) return;
        t.remaining -= 1;

        const pct = Math.min(100, ((t.total - t.remaining) / t.total) * 100);
        barEl.style.width = pct + '%';
        timeEl.textContent = formatTime(t.remaining);

        if (t.remaining <= 0) {
          clearInterval(t.interval);
          if (AUTO_COMPLETE_ON_TIMEOUT && window.currentModal === modalId) {
            const taskId = findTaskByModal(modalId);
            if (taskId) { markCompleted(taskId); }
            closeModal(modalId);
          } else {
            timeEl.textContent = 'Time‚Äôs up';
          }
        }
      }, 1000);
    }

    function stopTimer(modalId) {
      const t = timers[modalId];
      if (t && t.interval) clearInterval(t.interval);
      delete timers[modalId];
    }

    function findTaskByModal(modalId) {
      const li = document.querySelector(`li[data-modal="${modalId}"]`);
      return li ? li.id : null;
    }

    // ===== Modal plumbing =====
    function openModal(id) {
      const el = document.getElementById(id);
      if (!el) return;
      el.style.display = "block";
      window.currentModal = id;

      const closeBtn = el.querySelector('.close');
      if (closeBtn) closeBtn.focus();

      startTimer(id);
    }

    function closeModal(id) {
      const el = document.getElementById(id);
      if (!el) return;
      el.style.display = "none";
      if (window.currentModal === id) window.currentModal = null;
      stopTimer(id);
    }

    function openModalFromTask(taskId) {
      // ensure prior tasks are complete
      const order = ['task-1', 'task-2', 'task-3', 'task-4', 'task-5'];
      const idx = order.indexOf(taskId);
      const prevOk = order.slice(0, idx).every(isCompleted);
      if (!prevOk) return; // ignore if somehow clicked out of order

      const li = document.getElementById(taskId);
      if (!li) return;
      const modalId = li.getAttribute('data-modal');
      window.lastOpenedTaskId = taskId;
      openModal(modalId);
    }

    // Manual completion from modal buttons (Checkout, Instructions, Works of Choice)
    function completeTaskFromModal(taskId, modalId) {
      markCompleted(taskId);
      closeModal(modalId);
      window.lastOpenedTaskId = null;
    }

    // For iframe-based tasks (Typing, Activity)
    window.addEventListener('message', function(event) {
      if (event.data === 'activityComplete' && window.currentModal) {
        const taskId = findTaskByModal(window.currentModal);
        if (taskId) markCompleted(taskId);
        closeModal(window.currentModal);
        window.lastOpenedTaskId = null;
      }
    });

    // Click backdrop to close
    window.addEventListener('click', function(event) {
      const modals = document.querySelectorAll('.modal');
      modals.forEach(modal => {
        if (event.target === modal) {
          closeModal(modal.id);
        }
      });
    });

    // ESC to close
    window.addEventListener('keydown', function(event) {
      if (event.key === 'Escape' && window.currentModal) {
        closeModal(window.currentModal);
      }
    });

    // Reset checklist each load
    window.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('#taskList li').forEach(li => li.classList.remove('completed'));
      updateTaskLocks();

      // Timer toggle label change
      const toggle = document.getElementById('timerToggle');
      if (toggle) {
        const span = toggle.parentElement.querySelector('span');
        const setLabel = () => span.textContent = `‚è± Timers: ${toggle.checked ? 'On' : 'Off'}`;
        setLabel();
        toggle.addEventListener('change', () => {
          setLabel();
          if (window.currentModal) {
            stopTimer(window.currentModal);
            startTimer(window.currentModal);
          }
        });
      }
    });
  </script>
</body>
</html>
