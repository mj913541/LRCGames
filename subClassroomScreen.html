<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LRC Sub Screen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(to bottom, #fef9c3, #bbf7d0);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    /* Simple vine-ish divider */
    .vine-border {
      border-bottom: 3px dashed #15803d;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center pt-4 px-2">

  <!-- Header -->
  <header class="w-full max-w-5xl mb-4">
    <div class="flex items-center justify-between vine-border pb-2">
      <div>
        <h1 class="text-2xl md:text-3xl font-bold text-emerald-800">
          ü¶Å LRC Sub Screen
        </h1>
        <p class="text-sm md:text-base text-emerald-900">
          Tap <span class="font-semibold">START CLASS</span>, then <span class="font-semibold">NEXT</span> when the bell dings.
        </p>
      </div>
      <div class="text-right">
        <div id="nowDate" class="text-sm md:text-base font-semibold text-emerald-900"></div>
        <div id="nowTime" class="text-lg md:text-2xl font-mono text-emerald-950"></div>
        <div id="letterDayDisplay" class="mt-1 text-sm md:text-base font-bold text-orange-700"></div>
      </div>
    </div>
  </header>

  <!-- Main content -->
  <main class="w-full max-w-5xl flex-1 flex flex-col items-center justify-start gap-4">

    <!-- Current Class Card -->
    <section class="w-full bg-white/80 rounded-2xl shadow-md p-4 md:p-6">
      <h2 class="text-xl md:text-2xl font-semibold text-emerald-900 mb-2">
        Current Class
      </h2>
      <div id="currentClassInfo" class="text-base md:text-lg text-emerald-950 font-medium">
        Detecting schedule...
      </div>
      <p class="mt-2 text-sm text-emerald-800" id="subHint">
        If this doesn‚Äôt match what students tell you, no worries! Follow what the class teacher plans.
      </p>
    </section>

    <!-- Timer + Controls -->
    <section class="w-full bg-white/90 rounded-2xl shadow-md p-4 md:p-6 flex flex-col md:flex-row gap-6 items-center justify-between">
      <!-- Timer display -->
      <div class="flex-1 flex flex-col items-center">
        <div class="text-sm text-emerald-700 mb-1">Segment</div>
        <div id="segmentName" class="text-xl md:text-2xl font-semibold text-emerald-900 mb-3">
          Not started
        </div>
        <div id="timerDisplay" class="text-5xl md:text-6xl font-mono font-bold text-emerald-950 mb-2">
          00:00
        </div>
        <div id="segmentProgress" class="text-xs text-emerald-700">
          Tap <span class="font-semibold">START CLASS</span> to begin.
        </div>
      </div>

      <!-- Big buttons -->
      <div class="flex flex-col gap-3 w-full md:w-64">
        <button
          id="btnStart"
          class="w-full py-3 rounded-xl text-lg font-semibold bg-emerald-600 text-white shadow hover:bg-emerald-700 active:scale-95 transition"
        >
          ‚ñ∂ START CLASS
        </button>
        <button
          id="btnNext"
          class="w-full py-3 rounded-xl text-lg font-semibold bg-amber-500 text-white shadow hover:bg-amber-600 active:scale-95 transition disabled:opacity-40"
          disabled
        >
          ‚ûú NEXT ACTIVITY
        </button>
        <button
          id="btnEnd"
          class="w-full py-2.5 rounded-xl text-base font-semibold bg-slate-200 text-slate-800 shadow hover:bg-slate-300 active:scale-95 transition"
        >
          ‚èπ END / RESET
        </button>
      </div>
    </section>

    <!-- Small "teacher tools" area - override letter if needed -->
    <section class="w-full max-w-5xl mt-2 mb-6 text-xs text-slate-700">
      <details class="bg-white/70 rounded-xl p-3 shadow-sm">
        <summary class="cursor-pointer font-semibold text-emerald-900">
          Teacher Tools (optional)
        </summary>
        <div class="mt-2 space-y-2">
          <div>
            <label class="block mb-1 font-medium">Override Letter Day:</label>
            <select id="overrideLetter" class="border rounded px-2 py-1 text-sm">
              <option value="">Auto</option>
              <option value="A">A Day</option>
              <option value="B">B Day</option>
              <option value="C">C Day</option>
              <option value="D">D Day</option>
              <option value="E">E Day</option>
            </select>
            <p class="mt-1">
              If the auto letter is off (snow days, etc.), choose the correct one here.
            </p>
          </div>
          <p>
            If tech misbehaves: tell students they may go to the
            <span class="font-semibold">Lion Head games</span> on the LRC website.
          </p>
        </div>
      </details>
    </section>
  </main>

  <!-- Tiny sound for the "ding" -->
  <audio id="dingSound">
    <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg">
  </audio>

  <script>
    // -----------------------------
    // 1. Letter day calculation
    // -----------------------------
    const cycleLetters = ["A", "B", "C", "D", "E"];

    // TODO: Set this to the FIRST A DAY of your rotation this year
    // Month index is 0-based: (August = 7, September = 8, etc.)
    const firstADay = new Date(2025, 7, 12); // EXAMPLE: Aug 12, 2025 ‚Üí A Day

    // OPTIONAL: mark no-school dates here (YYYY-MM-DD)
    const noSchoolDates = [
      // "2025-09-01", // Labor Day
      // "2025-11-27", // Thanksgiving, etc.
    ];

    function isNoSchool(date) {
      const iso = date.toISOString().slice(0, 10);
      return noSchoolDates.includes(iso);
    }

    function getLetterDay(date) {
      // if weekend, we still compute the "cycle", but you won't have classes anyway
      // count school days from firstADay up to 'date'
      let d = new Date(firstADay.getFullYear(), firstADay.getMonth(), firstADay.getDate());
      let count = 0;

      // Walk from firstADay up to (and including) 'date'
      while (d.toDateString() < date.toDateString()) {
        d.setDate(d.getDate() + 1);

        const isWeekend = d.getDay() === 0 || d.getDay() === 6; // Sun=0, Sat=6
        if (!isWeekend && !isNoSchool(d)) {
          count++;
        }
      }

      const index = count % cycleLetters.length;
      return cycleLetters[index];
    }

    // -----------------------------
    // 2. Your schedule by letter
    // -----------------------------
    // Times are in "HH:MM" 24-hr format (local)
    const schedules = {
      A: [
        { start: "09:05", end: "09:50", label: "4th Grade ‚Äì Rosenthal" },
        { start: "10:05", end: "10:50", label: "2nd Grade ‚Äì Peterson" },
        { start: "11:05", end: "11:50", label: "3rd Grade ‚Äì Hossain" },
        { start: "12:05", end: "12:45", label: "Lunch" },
        { start: "12:45", end: "13:45", label: "Admin" },
        { start: "13:45", end: "14:30", label: "5th Grade ‚Äì Ultimo" },
        { start: "14:30", end: "14:45", label: "Prep" },
        { start: "14:45", end: "15:30", label: "1st Grade ‚Äì Rogers" },
      ],
      B: [
        { start: "09:05", end: "09:50", label: "4th Grade ‚Äì Cavello" },
        { start: "10:05", end: "10:50", label: "2nd Grade ‚Äì Schmidt" },
        { start: "11:05", end: "12:05", label: "Admin" },
        { start: "12:05", end: "12:45", label: "Lunch" },
        { start: "12:45", end: "13:45", label: "Admin" },
        { start: "13:45", end: "14:30", label: "5th Grade ‚Äì Isibindi" },
      ],
      C: [
        { start: "08:45", end: "09:05", label: "AM Duty & Opening" },
        { start: "09:05", end: "09:50", label: "Admin" },
        { start: "10:05", end: "10:50", label: "2nd Grade ‚Äì Adams" },
        { start: "11:05", end: "12:05", label: "3rd Grade ‚Äì Pulsa" },
        { start: "12:05", end: "12:45", label: "Lunch" },
        { start: "12:45", end: "13:45", label: "Admin" },
        { start: "13:45", end: "14:30", label: "5th Grade ‚Äì Amistad" },
        { start: "14:30", end: "15:30", label: "Prep" },
        { start: "15:30", end: "15:45", label: "Closing" },
      ],
      D: [
        { start: "12:20", end: "13:00", label: "Lunch" },
        { start: "12:45", end: "13:45", label: "Prep" },
        { start: "13:45", end: "14:30", label: "Prep" },
        { start: "14:30", end: "14:45", label: "Prep" },
        { start: "14:45", end: "15:30", label: "1st Grade ‚Äì Wilson" },
      ],
      E: [
        { start: "09:05", end: "09:50", label: "4th Grade ‚Äì Tomter" },
        { start: "10:05", end: "10:50", label: "Prep" },
        { start: "11:05", end: "12:05", label: "3rd Grade ‚Äì Carroll" },
        { start: "12:05", end: "12:45", label: "Lunch" },
        { start: "12:45", end: "13:45", label: "Prep" },
        { start: "13:45", end: "14:30", label: "5th Grade ‚Äì Reveur" },
        { start: "14:30", end: "14:45", label: "Prep" },
        { start: "14:45", end: "15:30", label: "1st Grade ‚Äì Day" },
      ],
    };

    function getCurrentClass(letter, date = new Date()) {
      const todaysSchedule = schedules[letter] || [];
      const currentMinutes = date.getHours() * 60 + date.getMinutes();

      for (const block of todaysSchedule) {
        const [sh, sm] = block.start.split(":").map(Number);
        const [eh, em] = block.end.split(":").map(Number);
        const startMin = sh * 60 + sm;
        const endMin = eh * 60 + em;
        if (currentMinutes >= startMin && currentMinutes < endMin) {
          return block;
        }
      }
      return null;
    }

    // -----------------------------
    // 3. Timer / segment logic
    // -----------------------------
    // Simple 3-part structure:
    const segments = [
      { name: "Welcome / Directions", minutes: 5 },
      { name: "Work Time", minutes: 20 },
      { name: "Checkout / Clean Up", minutes: 10 },
    ];

    let currentSegmentIndex = -1;
    let remainingSeconds = 0;
    let timerId = null;

    const timerDisplay = document.getElementById("timerDisplay");
    const segmentNameDisplay = document.getElementById("segmentName");
    const segmentProgress = document.getElementById("segmentProgress");
    const dingSound = document.getElementById("dingSound");

    const btnStart = document.getElementById("btnStart");
    const btnNext = document.getElementById("btnNext");
    const btnEnd = document.getElementById("btnEnd");

    function formatTime(sec) {
      const m = String(Math.floor(sec / 60)).padStart(2, "0");
      const s = String(sec % 60).padStart(2, "0");
      return `${m}:${s}`;
    }

    function showSegmentStatus() {
      if (currentSegmentIndex < 0) {
        segmentNameDisplay.textContent = "Not started";
        segmentProgress.textContent = "Tap START CLASS to begin.";
        timerDisplay.textContent = "00:00";
      } else if (currentSegmentIndex >= segments.length) {
        segmentNameDisplay.textContent = "All segments complete";
        segmentProgress.textContent = "You may line up or move to Lion Head games.";
      } else {
        const seg = segments[currentSegmentIndex];
        segmentNameDisplay.textContent = seg.name;
        const ofText = `Segment ${currentSegmentIndex + 1} of ${segments.length}`;
        segmentProgress.textContent = ofText;
      }
    }

    function stopTimer() {
      if (timerId) {
        clearInterval(timerId);
        timerId = null;
      }
    }

    function startSegment(index) {
      if (index < 0 || index >= segments.length) return;
      currentSegmentIndex = index;
      const seg = segments[index];
      remainingSeconds = seg.minutes * 60;
      showSegmentStatus();
      timerDisplay.textContent = formatTime(remainingSeconds);

      stopTimer();
      timerId = setInterval(() => {
        remainingSeconds--;
        if (remainingSeconds <= 0) {
          remainingSeconds = 0;
          timerDisplay.textContent = formatTime(remainingSeconds);
          stopTimer();
          // ding and enable Next
          try { dingSound.currentTime = 0; dingSound.play(); } catch (e) {}
          btnNext.disabled = currentSegmentIndex >= segments.length - 1;
        } else {
          timerDisplay.textContent = formatTime(remainingSeconds);
        }
      }, 1000);
    }

    btnStart.addEventListener("click", () => {
      currentSegmentIndex = 0;
      startSegment(currentSegmentIndex);
      btnNext.disabled = false;
    });

    btnNext.addEventListener("click", () => {
      if (currentSegmentIndex < segments.length - 1) {
        currentSegmentIndex++;
        startSegment(currentSegmentIndex);
        btnNext.disabled = currentSegmentIndex >= segments.length - 1;
      }
    });

    btnEnd.addEventListener("click", () => {
      stopTimer();
      currentSegmentIndex = -1;
      remainingSeconds = 0;
      btnNext.disabled = true;
      showSegmentStatus();
    });

    showSegmentStatus(); // initial

    // -----------------------------
    // 4. Date, time, letter day display
    // -----------------------------
    const nowDateEl = document.getElementById("nowDate");
    const nowTimeEl = document.getElementById("nowTime");
    const letterDayEl = document.getElementById("letterDayDisplay");
    const currentClassInfo = document.getElementById("currentClassInfo");
    const overrideLetterSelect = document.getElementById("overrideLetter");

    function updateDateTimeAndClass() {
      const now = new Date();
      nowDateEl.textContent = now.toLocaleDateString(undefined, {
        weekday: "long",
        month: "short",
        day: "numeric",
        year: "numeric",
      });
      nowTimeEl.textContent = now.toLocaleTimeString(undefined, {
        hour: "2-digit",
        minute: "2-digit",
      });

      // letter day
      let letter;
      const override = overrideLetterSelect.value;
      if (override) {
        letter = override;
      } else {
        letter = getLetterDay(now);
      }

      letterDayEl.textContent = `Today is: ${letter} Day`;

      const block = getCurrentClass(letter, now);
      if (block) {
        currentClassInfo.textContent =
          `Now: ${block.label} (${block.start}‚Äì${block.end})`;
      } else {
        currentClassInfo.textContent =
          "No class scheduled right now. Students may read or play Lion Head games if appropriate.";
      }
    }

    updateDateTimeAndClass();
    setInterval(updateDateTimeAndClass, 30 * 1000); // update every 30 seconds
    overrideLetterSelect.addEventListener("change", updateDateTimeAndClass);
  </script>
</body>
</html>
