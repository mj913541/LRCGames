<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Jungle Quest ‚Äì Typing Mastery (Standalone)</title>
  <!-- Tailwind CDN (for styling used in the component classes) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React 18 + ReactDOM UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel Standalone (to transpile JSX in the browser) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-emerald-50/40">
  <div id="root"></div>

  <script type="text/babel">

// ===============================================
// Typing Mastery Page ‚Äì Student + Teacher Prototype (Standalone)
// ===============================================

const {useMemo, useState} = React;

// ===== Config: XP / Levels (fast leveling) =====
const LEVEL_XP = 150; // +1 level every 150 XP
const TYPING_BADGE = { emoji: "üñêÔ∏è", name: "Keyboard Ninja" };
function levelFromXP(xp) { return Math.floor(xp / LEVEL_XP) + 1; }

// ===== Quests (Typing unit only) =====
const QUESTS = [
  { id: "q1", title: "Home Row Hero (Knowledge)", xp: 25, type: "knowledge", desc: "Identify which finger presses which key (quick check)." },
  { id: "q2", title: "Accuracy Apprentice (Practice)", xp: 50, type: "practice", desc: "Two guided practice sessions using correct fingers." },
  { id: "q3", title: "Boss: Typing Relay Race (Performance)", xp: 100, type: "performance", desc: "3‚Äëminute test ‚â• 20 WPM & ‚â• 90% accuracy + reflection.", boss: true, badge: TYPING_BADGE },
];

// ===== Demo Students (PIN = last 4 of birthday) =====
const DEMO_STUDENTS = [
  { id: "s01", first: "Alex", last: "R.", pin: "0512" },
  { id: "s02", first: "Jordan", last: "L.", pin: "1123" },
  { id: "s03", first: "Riley", last: "S.", pin: "0219" },
];

// ===== Local demo gradebook structure =====
// completions: { [studentId]: { [questId]: { points:number, evidence?:object } } }
const INITIAL_COMPLETIONS = { s03: { q1: { points: 25 }, q2: { points: 50 } }, s01: { q1: { points: 25 } } };

// ===== Helpers =====
function xpFor(completions) {
  if (!completions) return 0;
  return Object.values(completions).reduce((sum, row) => sum + (row?.points || 0), 0);
}
function isDone(completions, qid) { return Boolean(completions?.[qid]?.points); }
function nextQuestId(completions) {
  if (!isDone(completions, "q1")) return "q1";
  if (!isDone(completions, "q2")) return "q2";
  if (!isDone(completions, "q3")) return "q3";
  return null;
}
function hasBadge(completions) { return isDone(completions, "q3"); }

function PinLogin({ onLogin }) {
  const [pin, setPin] = useState("");
  const [err, setErr] = useState("");
  function go() {
    const s = DEMO_STUDENTS.find((x) => x.pin === pin.trim());
    if (!s) return setErr("PIN not found. Try 0512, 1123, 0219.");
    setErr("");
    onLogin(s);
  }
  return (
    <div className="p-4 rounded-2xl border bg-white shadow flex flex-col gap-2 max-w-sm">
      <h2 className="font-bold text-lg">Login with PIN</h2>
      <input value={pin} onChange={(e) => setPin(e.target.value)} maxLength={4} placeholder="MMDD" className="px-3 py-2 rounded-xl border" />
      <button onClick={go} className="px-3 py-2 rounded-xl border bg-emerald-50 hover:bg-emerald-100">Enter</button>
      {err && <div className="text-sm text-red-600">{err}</div>}
      <div className="text-xs opacity-70">Demo: 0512, 1123, 0219</div>
    </div>
  );
}

function XPBar({ xp }) {
  const lvl = levelFromXP(xp);
  const pct = Math.min(100, Math.round(((xp % LEVEL_XP) / LEVEL_XP) * 100));
  return (
    <div className="w-full">
      <div className="flex items-center justify-between text-xs mb-1"><span>Level {lvl}</span><span>{xp} XP</span></div>
      <div className="h-3 w-full bg-emerald-100 rounded-full overflow-hidden"><div className="h-3 bg-emerald-500" style={{ width: `${pct}%` }} /></div>
    </div>
  );
}

function KeyboardDiagram() {
  return (
    <svg viewBox="0 0 640 180" className="w-full rounded-xl border bg-white">
      <rect x="10" y="65" width="620" height="50" rx="10" fill="#ecfeff" />
      <text x="20" y="55" fontSize="12" fill="#065f46">Home Row: A S D F  J K L ;</text>
      {[
        { x: 40, w: 100, label: "Left Pinky" },
        { x: 140, w: 100, label: "Left Ring" },
        { x: 240, w: 100, label: "Left Middle" },
        { x: 340, w: 100, label: "Left Index" },
        { x: 440, w: 100, label: "Right Index" },
        { x: 540, w: 80, label: "Right Middle/Ring/Pinky" },
      ].map((z, i) => (
        <g key={i}>
          <rect x={z.x} y="70" width={z.w} height="40" rx="8" fill="#d1fae5" stroke="#10b981" />
          <text x={z.x + z.w / 2} y="95" fontSize="11" textAnchor="middle" fill="#064e3b">{z.label}</text>
        </g>
      ))}
      {"ASDF JKL;".split("").map((k, i) => (
        <g key={i}>
          <rect x={60 + i * 55} y="120" width="40" height="40" rx="6" fill="#f0fdf4" stroke="#10b981" />
          <text x={80 + i * 55} y="145" fontSize="14" textAnchor="middle" fill="#064e3b">{k}</text>
        </g>
      ))}
    </svg>
  );
}

function KnowledgeCard({ onComplete, done }) {
  const [checked, setChecked] = useState({ posture: false, fingers: false, quiz: false });
  const ready = Object.values(checked).every(Boolean);
  return (
    <div className="p-4 rounded-xl border bg-white flex flex-col gap-3">
      <h4 className="font-semibold">1) Knowledge ‚Äì Home Row Hero</h4>
      <p className="text-sm opacity-80">Watch a mini-lesson. Then check all that you can do:</p>
      <ul className="text-sm grid gap-2">
        <li><label className="flex gap-2 items-center"><input type="checkbox" checked={checked.posture} onChange={(e)=>setChecked({...checked, posture:e.target.checked})}/> I can sit with good typing posture.</label></li>
        <li><label className="flex gap-2 items-center"><input type="checkbox" checked={checked.fingers} onChange={(e)=>setChecked({...checked, fingers:e.target.checked})}/> I know which finger presses which home row key.</label></li>
        <li><label className="flex gap-2 items-center"><input type="checkbox" checked={checked.quiz} onChange={(e)=>setChecked({...checked, quiz:e.target.checked})}/> I passed the 5‚Äëquestion home row check.</label></li>
      </ul>
      <KeyboardDiagram />
      <button disabled={done||!ready} onClick={onComplete} className="px-3 py-2 rounded-xl border bg-emerald-50 hover:bg-emerald-100 disabled:opacity-50">Mark Complete (+25 XP)</button>
    </div>
  );
}

function PracticeCard({ onComplete, done }) {
  const [s1, setS1] = useState(false);
  const [s2, setS2] = useState(false);
  const ready = s1 && s2;
  return (
    <div className="p-4 rounded-xl border bg-white flex flex-col gap-3">
      <h4 className="font-semibold">2) Practice ‚Äì Accuracy Apprentice</h4>
      <ol className="text-sm list-decimal ml-5 space-y-2">
        <li>Complete a 5‚Äëmin home‚Äërow practice (Typing.com). Check when done.</li>
        <li>Complete a second 5‚Äëmin practice on a different lesson. Check when done.</li>
      </ol>
      <div className="flex flex-col gap-2 text-sm">
        <label className="flex items-center gap-2"><input type="checkbox" checked={s1} onChange={(e)=>setS1(e.target.checked)}/> Session 1 complete</label>
        <label className="flex items-center gap-2"><input type="checkbox" checked={s2} onChange={(e)=>setS2(e.target.checked)}/> Session 2 complete</label>
      </div>
      <button disabled={done||!ready} onClick={onComplete} className="px-3 py-2 rounded-xl border bg-emerald-50 hover:bg-emerald-100 disabled:opacity-50">Mark Complete (+50 XP)</button>
    </div>
  );
}

function PerformanceCard({ onComplete, done }) {
  const [wpm, setWpm] = useState("");
  const [acc, setAcc] = useState("");
  const [refl, setRefl] = useState("");
  const meets = Number(wpm) >= 20 && Number(acc) >= 90;
  const ready = meets && refl.trim().length >= 20;
  return (
    <div className="p-4 rounded-xl border bg-white flex flex-col gap-3">
      <h4 className="font-semibold">3) Performance ‚Äì Boss: Typing Relay Race</h4>
      <div className="text-sm opacity-80">Goal: ‚â• <b>20 WPM</b> and ‚â• <b>90% accuracy</b> in a 3‚Äëminute test + a short reflection.</div>
      <div className="grid sm:grid-cols-3 gap-2 text-sm">
        <input className="px-3 py-2 border rounded-xl" placeholder="WPM" value={wpm} onChange={(e)=>setWpm(e.target.value)} />
        <input className="px-3 py-2 border rounded-xl" placeholder="Accuracy %" value={acc} onChange={(e)=>setAcc(e.target.value)} />
        <input className="px-3 py-2 border rounded-xl sm:col-span-3" placeholder="Reflection (What improved? Which finger was hardest?)" value={refl} onChange={(e)=>setRefl(e.target.value)} />
      </div>
      {!meets && <div className="text-xs text-amber-700">Tip: Keep practicing until you reach the goal. You‚Äôve got this!</div>}
      <button disabled={done||!ready} onClick={onComplete} className="px-3 py-2 rounded-xl border bg-emerald-50 hover:bg-emerald-100 disabled:opacity-50">Mark Complete (+100 XP + üñêÔ∏è)</button>
    </div>
  );
}

function QuestLadder({ completions, onComplete }) {
  return (
    <div className="grid gap-3">
      <KnowledgeCard done={isDone(completions, "q1")} onComplete={() => onComplete("q1")} />
      <PracticeCard done={isDone(completions, "q2")} onComplete={() => onComplete("q2")} />
      <PerformanceCard done={isDone(completions, "q3")} onComplete={() => onComplete("q3")} />
    </div>
  );
}

function StudentView({ student, completions, onStudentComplete }) {
  const xp = React.useMemo(() => xpFor(completions), [completions]);
  const badgeEarned = hasBadge(completions);
  return (
    <div className="p-4 rounded-2xl border bg-white shadow flex flex-col gap-4">
      <div className="flex items-center justify-between">
        <div>
          <div className="text-lg font-bold">{student.first} {student.last}</div>
          <div className="text-xs opacity-70">PIN: {student.pin}</div>
        </div>
        <div className="w-64"><XPBar xp={xp} /></div>
      </div>
      <div>
        <h3 className="font-semibold mb-2">‚å®Ô∏è Keyboard Cavern ¬∑ Touch Typing</h3>
        <QuestLadder completions={completions} onComplete={onStudentComplete} />
      </div>
      <div className="text-sm">
        <div className="font-medium">Badge:</div>
        {badgeEarned ? (
          <div className="flex items-center gap-2"><span className="text-xl">{TYPING_BADGE.emoji}</span> {TYPING_BADGE.name}</div>
        ) : (
          <div className="opacity-70">Complete the Boss Quest to earn {TYPING_BADGE.emoji} {TYPING_BADGE.name}</div>
        )}
      </div>
    </div>
  );
}

function TeacherChecklist({ values, onChange }) {
  const v = values || { posture: false, fingers: false, tenFingers: false, eyesOnScreen: false };
  function setv(k, val) { onChange({ ...v, [k]: val }); }
  return (
    <div className="grid grid-cols-2 gap-2 text-sm">
      <label className="flex items-center gap-2"><input type="checkbox" checked={v.posture} onChange={(e)=>setv("posture", e.target.checked)} /> Correct posture</label>
      <label className="flex items-center gap-2"><input type="checkbox" checked={v.fingers} onChange={(e)=>setv("fingers", e.target.checked)} /> Correct finger use</label>
      <label className="flex items-center gap-2"><input type="checkbox" checked={v.tenFingers} onChange={(e)=>setv("tenFingers", e.target.checked)} /> Using all 10 fingers</label>
      <label className="flex items-center gap-2"><input type="checkbox" checked={v.eyesOnScreen} onChange={(e)=>setv("eyesOnScreen", e.target.checked)} /> Eyes on screen (not keys)</label>
    </div>
  );
}

function TeacherView({ students, currentId, setCurrentId, gradebook, setGradebook, notes, setNotes }) {
  const sid = currentId || students[0]?.id;
  const student = students.find((s) => s.id === sid) || students[0];
  const completions = gradebook[student.id] || {};
  const [check, setCheck] = useState(notes[student.id]?.check || {});

  function grant(qid) {
    const q = QUESTS.find((x) => x.id === qid);
    if (!q) return;
    setGradebook((prev) => ({ ...prev, [student.id]: { ...(prev[student.id]||{}), [qid]: { points: q.xp } } }));
  }
  function revoke(qid) {
    setGradebook((prev) => {
      const copy = { ...(prev[student.id] || {}) };
      delete copy[qid];
      return { ...prev, [student.id]: copy };
    });
  }
  function saveNotes() { setNotes((prev) => ({ ...prev, [student.id]: { check } })); }

  function downloadCSV() {
    const rows = [["student_id","quest_id","points"]];
    Object.entries(gradebook).forEach(([sid, qs]) => {
      Object.entries(qs).forEach(([qid, obj]) => rows.push([sid, qid, obj.points]));
    });
    const csv = rows.map(r => r.join(",")).join("\n");
    const blob = new Blob([csv], { type: "text/csv" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = "typing_grades_export.csv"; a.click();
    URL.revokeObjectURL(url);
  }

  return (
    <div className="p-4 rounded-2xl border bg-white shadow flex flex-col gap-3">
      <div className="flex flex-wrap items-center gap-2">
        <select value={sid} onChange={(e)=>setCurrentId(e.target.value)} className="px-3 py-2 rounded-xl border">
          {students.map((s)=> <option key={s.id} value={s.id}>{s.first} {s.last}</option>)}
        </select>
        <button onClick={()=>grant("q1")} className="px-3 py-1.5 rounded-xl border bg-emerald-50 hover:bg-emerald-100">Approve Q1 (+25)</button>
        <button onClick={()=>grant("q2")} className="px-3 py-1.5 rounded-xl border bg-emerald-50 hover:bg-emerald-100">Approve Q2 (+50)</button>
        <button onClick={()=>grant("q3")} className="px-3 py-1.5 rounded-xl border bg-emerald-50 hover:bg-emerald-100">Approve Q3 (+100)</button>
        <button onClick={()=>{revoke("q3")}} className="px-3 py-1.5 rounded-xl border bg-red-50 hover:bg-red-100">Revoke Q3</button>
        <button onClick={downloadCSV} className="px-3 py-1.5 rounded-xl border bg-blue-50 hover:bg-blue-100">Export CSV</button>
      </div>

      <div className="grid md:grid-cols-2 gap-4">
        <div className="rounded-xl border p-3">
          <div className="font-semibold mb-2">Observation Checklist</div>
          <TeacherChecklist values={check} onChange={setCheck} />
          <button onClick={saveNotes} className="mt-3 px-3 py-1.5 rounded-xl border bg-white hover:bg-emerald-50">Save checklist</button>
        </div>
        <div className="rounded-xl border p-3">
          <div className="font-semibold mb-2">Completions</div>
          <ul className="text-sm space-y-1">
            {QUESTS.map((q) => (
              <li key={q.id} className="flex items-center justify-between">
                <span>{q.title}</span>
                {isDone(gradebook[student.id], q.id) ? <span className="text-emerald-600">Granted</span> : <span className="opacity-60">Pending</span>}
              </li>
            ))}
          </ul>
        </div>
      </div>
    </div>
  );
}

function App() {
  const [mode, setMode] = useState("student");
  const [current, setCurrent] = useState(null); // student object
  const [grades, setGrades] = useState(INITIAL_COMPLETIONS); // map: studentId -> { questId: {points} }
  const [notes, setNotes] = useState({});

  const completions = current ? grades[current.id] : null;
  const xp = React.useMemo(() => xpFor(completions), [completions]);

  function completeQuest(qid) {
    const q = QUESTS.find((x) => x.id === qid); if (!q || !current) return;
    setGrades((prev) => ({ ...prev, [current.id]: { ...(prev[current.id]||{}), [qid]: { points: q.xp } } }));
  }

  function logout() { setCurrent(null); }

  return (
    <div className="min-h-screen w-full p-6">
      <div className="max-w-6xl mx-auto flex flex-col gap-6">
        <header className="flex items-center justify-between">
          <h1 className="text-2xl font-extrabold tracking-tight">ü¶Å Jungle Quest ‚Äì Typing Mastery</h1>
          <div className="flex items-center gap-2 text-xs">
            <button onClick={()=>setMode("student")} className={`px-3 py-1.5 rounded-xl border ${mode==='student'?'bg-emerald-100':'bg-white'}`}>Student View</button>
            <button onClick={()=>setMode("teacher")} className={`px-3 py-1.5 rounded-xl border ${mode==='teacher'?'bg-emerald-100':'bg-white'}`}>Teacher View</button>
          </div>
        </header>

        {mode === "student" && (
          !current ? (
            <PinLogin onLogin={setCurrent} />
          ) : (
            <>
              <StudentView student={current} completions={completions} onStudentComplete={completeQuest} />
              <div className="flex items-center justify-between text-xs opacity-70">
                <span>Level: {levelFromXP(xp)} ¬∑ XP: {xp}</span>
                <button onClick={logout} className="px-3 py-1.5 rounded-xl border bg-white hover:bg-emerald-50">Switch student</button>
              </div>
            </>
          )
        )}

        {mode === "teacher" && (
          <TeacherView
            students={DEMO_STUDENTS}
            currentId={current?.id}
            setCurrentId={(id)=>setCurrent(DEMO_STUDENTS.find(s=>s.id===id))}
            gradebook={grades}
            setGradebook={setGrades}
            notes={notes}
            setNotes={setNotes}
          />
        )}

        <footer className="text-xs text-center opacity-70">Standalone demo. For production, hook to Google Classroom & Google Sheets (PIN-based lookup).</footer>
      </div>
    </div>
  );
}

// React 18 root
const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);

  </script>
</body>
</html>
