<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>LRC — A1 Find It Fast</title>
<style>
  :root{ --bgA:#ecfdf5; --bgB:#d1fae5; --ink:#0f172a; --muted:#475569; --brand:#10b981; --brandDark:#059669; --border:#e2e8f0; --amber:#f59e0b; }
  html,body{height:100%} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,"Helvetica Neue",Arial,sans-serif;color:var(--ink);background:linear-gradient(to bottom,var(--bgA),var(--bgB))}
  .container{max-width:1100px;margin:0 auto;padding:24px}
  .row{display:flex;gap:12px;align-items:center}
  .card{background:#fff;border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 16px rgba(15,23,42,.06)}
  .card>.content{padding:16px}
  .btn{appearance:none;border:1px solid transparent;background:var(--brand);color:#fff;border-radius:10px;padding:10px 14px;cursor:pointer;font-weight:600}
  .btn:hover{background:var(--brandDark)} .btn.secondary{background:#fff;border-color:var(--border);color:var(--ink)}
  .kbd{font-family:ui-monospace,Menlo,Consolas,monospace;border:1px solid var(--border);background:#f8fafc;border-radius:6px;padding:2px 6px;font-size:12px}
  .pill{display:inline-flex;align-items:center;gap:6px;border:1px solid #fde68a;background:#fef3c7;color:#92400e;border-radius:999px;padding:4px 10px;font-size:12px}
  .muted{color:var(--muted)}
</style>
</head>
<body>
<div class="container">
  <header class="row" style="justify-content:space-between;margin-bottom:16px">
    <a class="btn secondary" href="jungleQuestHub.html">← Hub</a>
    <h1>A1: Find It Fast</h1>
    <span class="kbd" id="who">…</span>
  </header>

  <div class="card"><div class="content" id="stage">
    <!-- lesson stages render here -->
  </div></div>
</div>

<script>
  // ---- Shared state (same key as hub) ----
  const STORAGE_KEY = 'lrc_m0_state_v2';
  const LEVELS = ['Level 1 (Start Here)','Level 2','Level 3','Level 4','Level 5'];
  function loadState(){ try{ const raw=localStorage.getItem(STORAGE_KEY); return raw? JSON.parse(raw):null; }catch(e){ return null; } }
  function saveState(s){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(s)); }catch(e){} }
  function initialState(){
    const s = loadState();
    if(s){ if(s.profile && s.profile.class_code && !s.profile.level){ s.profile.level=LEVELS[0]; delete s.profile.class_code; saveState(s); } return s; }
    return { profile:{ nickname:'', level: LEVELS[0] }, progress:{}, badges:[] };
  }
  let HUB = initialState();

  // Require nickname; if missing, bounce to hub to log in
  if(!HUB.profile.nickname){
    location.href = 'jungleQuestHub.html?next=' + encodeURIComponent(location.pathname + location.search);
  }

  // Show who is logged in
  document.getElementById('who').textContent = `${HUB.profile.nickname} · ${HUB.profile.level}`;

  // ---- A1 lesson flow ----
  const stage = document.getElementById('stage');
  let step = 0;           // 0 warmup, 1 learn, 2 guided, 3 independent (3 Qs), 4 exit
  let correct = 0;        // score for independent Qs
  let idx = 0;            // question index

  const BANK = [
    { q:"Best starting approach?", opts:["Type 'recycling' and filter to Book + In","Search 'reduce reuse' and open first eBook","Sort by author first"], a:0 },
    { q:"Call number likely looks like…", opts:["B JEMISON","FIC JEM","398.2 JEM"], a:0 },
    { q:"Which filter speeds this up?", opts:["Availability:In","Format:eBook","Collection:Biography"], a:1 },
  ];

  function draw(){
    if(step===0){
      stage.innerHTML = `
        <h3>Warm-Up</h3>
        <p>Which filter would speed this search the most?</p>
        <div class="row" style="flex-wrap:wrap;gap:8px">
          <span class="pill">Format:Book</span>
          <span class="pill">Availability:In</span>
          <span class="pill">Collection:Biography</span>
        </div>
        <div style="height:12px"></div>
        <button id="next" class="btn">Next</button>`;
      document.getElementById('next').onclick = ()=>{ step=1; draw(); };
      return;
    }

    if(step===1){
      stage.innerHTML = `
        <h3>Learn</h3>
        <ul>
          <li><b>Keyword vs. Subject:</b> Keywords match anywhere; Subjects are librarian tags.</li>
          <li><b>Filters:</b> Narrow by format (Book/eBook), availability, collection (Biography).</li>
          <li><b>Call Number:</b> Use it to locate the book on the shelf.</li>
        </ul>
        <div style="height:12px"></div>
        <button id="toGuided" class="btn">Guided Practice</button>`;
      document.getElementById('toGuided').onclick = ()=>{ step=2; draw(); };
      return;
    }

    if(step===2){
      stage.innerHTML = `
        <h3>Guided Practice</h3>
        <p>Scenario: Find a <b>print book</b> about <b>recycling</b> that is <b>available now</b>.</p>
        <p class="muted">Hint: try <span class="kbd">recycling</span> then set <span class="kbd">Format:Book</span> + <span class="kbd">Availability:In</span>.</p>
        <div style="height:12px"></div>
        <button id="toInd" class="btn">Start Independent</button>`;
      document.getElementById('toInd').onclick = ()=>{ step=3; draw(); };
      return;
    }

    if(step===3){
      const item = BANK[idx % BANK.length];
      stage.innerHTML = `
        <h3>Independent</h3>
        <p><b>Question:</b> ${item.q}</p>
        <div id="opts"></div>
        <p class="muted">Question ${idx+1} of 3</p>`;
      const wrap = document.getElementById('opts');
      item.opts.forEach((t,i)=>{
        const b = document.createElement('button');
        b.className = 'btn secondary'; b.style.display='block'; b.style.margin='6px 0';
        b.textContent = t;
        b.onclick = ()=>{
          if(i===item.a) correct++;
          idx++;
          if(idx>=3){ step=4; }
          draw();
        };
        wrap.appendChild(b);
      });
      return;
    }

    if(step===4){
      const status = (correct===3)?'On Track' : (correct===2)? 'Grow' : 'Reteach';
      // Save progress for A1
      HUB.progress.A1 = { exit: correct, max: 3, status };
      try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(HUB)); }catch(e){}
      stage.innerHTML = `
        <h3>Exit Ticket</h3>
        <p>Score: ${correct}/3 · Mastery: <b>${status}</b></p>
        <div style="height:12px"></div>
        <a class="btn" href="jungleQuestHub.html?done=1">Save & Return to Hub</a>`;
      return;
    }
  }

  draw();
</script>
</body>
</html>
