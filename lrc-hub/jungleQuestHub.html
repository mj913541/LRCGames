<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lions' Den — Jungle Quest Hub</title>
  <style>
    :root{
      --bgA:#ecfdf5; --bgB:#d1fae5; --ink:#0f172a; --muted:#475569;
      --brand:#10b981; --brandDark:#059669; --border:#e2e8f0;
    }
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,"Helvetica Neue",Arial,sans-serif;color:var(--ink);background:linear-gradient(to bottom,var(--bgA),var(--bgB))}
    .container{max-width:1100px;margin:0 auto;padding:24px}
    .row{display:flex;gap:12px;align-items:center}
    .grid{display:grid;gap:16px}
    .grid2{grid-template-columns:repeat(2,minmax(0,1fr))}
    .card{background:#fff;border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 16px rgba(15,23,42,.06)}
    .card>.content{padding:16px}
    .btn{appearance:none;border:1px solid transparent;background:var(--brand);color:#fff;border-radius:10px;padding:10px 14px;cursor:pointer;font-weight:600}
    .btn:hover{background:var(--brandDark)}
    .btn.secondary{background:#fff;border-color:var(--border);color:var(--ink)}
    .input, select{width:100%;height:40px;border:1px solid var(--border);border-radius:8px;padding:0 12px}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:4px}
    .kbd{font-family:ui-monospace,Menlo,Consolas,monospace;border:1px solid var(--border);background:#f8fafc;border-radius:6px;padding:2px 6px;font-size:12px}
    .progress{height:10px;background:#e5e7eb;border-radius:999px;overflow:hidden}
    .progress>div{height:100%;background:linear-gradient(90deg,var(--brand),#34d399)}
    .zoneA{background:linear-gradient(135deg,#bbf7d0,#86efac)}
    .zoneB{background:linear-gradient(135deg,#d9f99d,#bef264)}
  </style>
</head>
<body>
  <div class="container">
<header class="row" style="justify-content:space-between;margin-bottom:16px">
  <h1>Lions' Den — Jungle Quest Hub</h1>
  <div class="row" style="gap:8px">
    <a class="btn secondary" href="teacher.html">Teacher</a>
    <span class="kbd" id="who">Not logged in</span>
  </div>
</header>


    <!-- Login Card -->
    <div class="card" id="loginCard"><div class="content">
      <h2>Login</h2>
      <p class="muted">Enter a nickname and choose your <b>Level</b>. Most students start at <b>Level 1 (Start Here)</b>. Progress saves on this device.</p>
      <div class="grid grid2">
        <div>
          <label for="nickname">Nickname</label>
          <input id="nickname" class="input" placeholder="e.g., L1-Tiger-07" />
        </div>
        <div>
          <label for="level">Level</label>
          <select id="level"></select>
        </div>
      </div>
      <div style="height:12px"></div>
      <button id="enterBtn" class="btn">Enter</button>
    </div></div>

    <!-- Hub Card -->
    <div class="card" id="hubCard" style="display:none"><div class="content">
      <h2>Choose a Zone</h2>
      <div class="row" style="gap:8px;align-items:center">
        <div style="min-width:120px">Overall Progress</div>
        <div class="progress" style="flex:1"><div id="pbar" style="width:0%"></div></div>
        <div id="plabel" class="kbd">0%</div>
      </div>
      <div class="grid grid2" style="margin-top:12px">
        <div class="card zoneA"><div class="content">
          <h3>Zone A — Destiny Discover</h3>
          <p class="muted">Quest A1: Find It Fast</p>
          <!-- This link will work after we add a1.html in a later step -->
          <a class="btn" href="a1.html">Enter</a>
        </div></div>
        <div class="card zoneB"><div class="content">
          <h3>Zone B — Chromebook + Trackpad</h3>
          <p class="muted">Quest B2: Trackpad Trail 1</p>
          <!-- This link will work after we add b2.html in a later step -->
          <a class="btn" href="b2.html">Enter</a>
        </div></div>
      </div>
    </div></div>
  </div>

  <script>
    // Minimal state (works now; expandable later)
    const STORAGE_KEY = 'lrc_m0_state_v2';
    const LEVELS = ['Level 1 (Start Here)','Level 2','Level 3','Level 4','Level 5'];

    function loadState(){ try{ const raw=localStorage.getItem(STORAGE_KEY); return raw? JSON.parse(raw):null; }catch(e){ return null; } }
    function saveState(s){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(s)); }catch(e){} }
    function initialState(){
      const s = loadState();
      if(s){ if(s.profile && s.profile.class_code && !s.profile.level){ s.profile.level=LEVELS[0]; delete s.profile.class_code; saveState(s); } return s; }
      return { profile:{ nickname:'', level: LEVELS[0] }, progress:{}, badges:[] };
    }
    let HUB = initialState();

    // UI helpers
    const $ = (id)=>document.getElementById(id);
    function pctProgress(){ const done=['A1','B2'].filter(q=>HUB.progress[q]); return Math.round(done.length/2*100); }

    // Populate level dropdown
    const levelSel = $('level');
    LEVELS.forEach(l=>{ const o=document.createElement('option'); o.value=l; o.textContent=l; levelSel.appendChild(o); });

    // Pre-fill if returning
    $('nickname').value = HUB.profile.nickname || '';
    levelSel.value = HUB.profile.level || LEVELS[0];

    // Enter
    $('enterBtn').onclick = ()=>{
      const nick = $('nickname').value.trim();
      if(!nick){ alert('Please enter a nickname'); return; }
      HUB.profile.nickname = nick;
      HUB.profile.level = levelSel.value;
      saveState(HUB);
      $('who').textContent = `${HUB.profile.nickname} · ${HUB.profile.level}`;
      $('loginCard').style.display = 'none';
      $('hubCard').style.display = '';
      const p = pctProgress();
      $('pbar').style.width = p + '%';
      $('plabel').textContent = p + '%';
    };

    // If already logged in, show hub immediately
    if (HUB.profile.nickname) {
      $('who').textContent = `${HUB.profile.nickname} · ${HUB.profile.level}`;
      $('loginCard').style.display = 'none';
      $('hubCard').style.display = '';
      const p = pctProgress();
      $('pbar').style.width = p + '%';
      $('plabel').textContent = p + '%';
    }

// Deep-link: auto-open a quest after login if ?quest=A1 or ?quest=B2 is present
(function handleDeepLink(){
  const params = new URLSearchParams(location.search);
  const q = params.get('quest'); // "A1" or "B2"
  if (!q) return;

  // If already logged in, jump straight to page
  if (HUB.profile.nickname) {
    if (q === 'A1') location.href = 'a1.html';
    if (q === 'B2') location.href = 'b2.html';
    return;
  }

  // Not logged in yet: after clicking Enter, go to the quest
  const originalEnter = document.getElementById('enterBtn').onclick;
  document.getElementById('enterBtn').onclick = () => {
    originalEnter();
    if (HUB.profile.nickname) {
      if (q === 'A1') location.href = 'a1.html';
      if (q === 'B2') location.href = 'b2.html';
    }
  };
})();


  </script>
</body>
</html>
