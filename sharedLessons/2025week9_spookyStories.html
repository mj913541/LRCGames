<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LRC Week 9 Spooky Stories</title>
  <style>
    .hidden {display: none;}
    body {
      font-family: 'Comic Sans MS', Arial, Helvetica, sans-serif;
      background: url('../pictures/backgrounds/spookyJungleBackground.png.png') no-repeat center center fixed;
      background-size: cover;
      color: #2e3d2f;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
      background-color: rgba(255, 255, 255, 0.8);
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 6px 12px rgba(0,0,0,0.2);
    }

    header .title-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 28px;
      flex-wrap: wrap;
    }

    header img { width: 75px; height: 75px; }
    @media (max-width: 520px) {
      header img { width: 75px; height: 75px; }
    }

    header h1 { font-size: 2.5em; color: #2e3d2f; margin: 0; }

    section {
      background-color: rgba(255, 255, 255, 0.9);
      border-radius: 12px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
      padding: 20px;
      margin-bottom: 10px;
    }

    h2 { color: #4f6f52; margin-bottom: 10px; }

    a img:hover { transform: scale(1.05); transition: transform 0.2s; }

    /* ===== Top controls (timer toggle) ===== */
    .top-controls {
      display: flex;
      align-items: center;
      gap: 12px;
      justify-content: flex-end;
      margin-bottom: -8px;
    }
    .toggle {
      display: inline-flex; align-items: center; gap: 6px;
      background: rgba(255,255,255,0.9);
      border: 1px solid #e6eddc; border-radius: 8px; padding: 6px 10px;
    }

    /* ===== Locks UI ===== */
    .locks-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 14px;
      align-items: start;
    }

    .lock-btn {
      --lock-size: 90px;
      --ring: 3px;
      --text: #2e3d2f;
      position: relative;
      background: transparent;
      border: none;
      cursor: default;
      display: grid;
      justify-items: center;
      align-items: center;
      gap: 8px;
      padding: 10px 6px;
      border-radius: 12px;
    }

    .lock-btn:focus-visible {
      outline: 3px solid #7c9a63;
      outline-offset: 2px;
      border-radius: 14px;
    }

    .lock-btn::before {
      content: attr(data-step);
      width: var(--lock-size);
      height: var(--lock-size);
      border-radius: 999px;
      display: grid;
      place-items: center;
      font-weight: 900;
      font-size: 1.6rem;
      color: #fff;
      box-shadow: 0 6px 14px rgba(0,0,0,0.25);
    }

    .lock-btn .lock-label {
      font-size: 0.95rem;
      text-align: center;
      color: var(--text);
      background: rgba(255,255,255,0.85);
      padding: 6px 10px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.12);
    }

    .lock-btn::after {
      content: "";
      position: absolute;
      width: 54%;
      aspect-ratio: 1/1;
      top: 22%;
      left: 50%;
      transform: translateX(-50%);
      background-repeat: no-repeat;
      background-position: center;
      background-size: contain;
      filter: drop-shadow(0 2px 2px rgba(0,0,0,0.25));
    }

    /* Locked (grey, closed) */
    .lock-btn.locked::before {
      background: linear-gradient(145deg, #cbd5c2, #9eaa9e);
      border: var(--ring) solid #e6eddc;
    }
    .lock-btn.locked { cursor: not-allowed; }
    .lock-btn.locked::after {
      background-image: url("data:image/svg+xml;utf8,\
      <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'>\
        <g fill='none' stroke='%23808c80' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'>\
          <rect x='12' y='28' width='40' height='28' rx='6' fill='%23dfe6da'/>\
          <path d='M20 28v-8a12 12 0 0 1 24 0v8'/>\
        </g></svg>");
    }

    /* Unlocked/Ready (green, open) */
    .lock-btn.unlocked { cursor: pointer; }
    .lock-btn.unlocked::before {
      background: linear-gradient(145deg, #7ccf8f, #3fa35b);
      border: var(--ring) solid #e6f5e9;
    }
    .lock-btn.unlocked:hover::before {
      transform: translateY(-2px);
      transition: transform 120ms ease;
    }
    .lock-btn.unlocked::after {
      background-image: url("data:image/svg+xml;utf8,\
      <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'>\
        <g fill='none' stroke='%232b8a46' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'>\
          <rect x='12' y='28' width='40' height='28' rx='6' fill='%23d9f5e1'/>\
          <path d='M24 20a12 12 0 0 1 24 0v0'/>\
          <path d='M24 20c0-6.6 5.4-12 12-12'/>\
        </g></svg>");
    }

    /* Completed (green with check) */
    .lock-btn.completed::before {
      background: linear-gradient(145deg, #7ccf8f, #3fa35b);
      border: var(--ring) solid #e6f5e9;
      content: "‚úì";
      font-size: 2rem;
    }
    .lock-btn.completed::after { display: none; }

    .locks-hint {
      margin-top: 8px;
      color: #4f6f52;
      font-size: 0.95rem;
    }

    /* ===== Modal ===== */
    .modal {
      display: none; position: fixed; z-index: 1000; inset: 0;
      width: 100vw; height: 100vh; background-color: rgba(0,0,0,0.6);
    }
    .modal-content {
      position: absolute; inset: 0; background-color: #fefefe;
      border: 2px solid #7c9a63; border-radius: 0; box-shadow: 0 10px 25px rgba(0,0,0,0.3);
      display: flex; flex-direction: column; box-sizing: border-box;
    }
    .modal-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 12px 18px; border-bottom: 1px solid #e2e2e2; background: #ffffff; gap: 12px;
    }
    .modal-header h3 { margin: 0; color: #2e3d2f; }
    .close { color: green; font-size: 60px; font-weight: bold; cursor: pointer; line-height: 1; padding: 4px 10px; border-radius: 6px; }
    .close:hover { background: #f0f0f0; }
    .modal-body { flex: 1 1 auto; display: flex; min-height: 0; }
    .modal-body iframe { width: 100%; height: 100%; border: 0; }

    /* Timer bar */
    .timer-wrap { flex: 0 0 auto; width: 210px; }
    .timer-label { font-size: 0.8rem; color: #4f6f52; }
    .timer-bar { width: 100%; height: 8px; background: #e6eddc; border-radius: 6px; overflow: hidden; }
    .timer-fill { height: 100%; width: 0%; background: #7c9a63; transition: width 1s linear; }

    /* ===== Modal Button Style Upgrade ===== */
    .modal-body button,
    .modal-body a.button {
      display: inline-block;
      background-color: #58b86d; /* jungle green */
      color: #fff;
      font-family: 'Comic Sans MS', Arial, sans-serif;
      font-size: 1.2rem;
      font-weight: bold;
      padding: 14px 28px;
      border: none;
      border-radius: 16px;
      box-shadow: 0 5px 12px rgba(0,0,0,0.2);
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      text-align: center;
    }

    .modal-body button:hover,
    .modal-body a.button:hover {
      background-color: #3fa35b; /* darker hover green */
      transform: scale(1.05);
      box-shadow: 0 6px 16px rgba(0,0,0,0.25);
    }

    .modal-body button:active { transform: scale(0.97); }

    .modal-body button span, 
    .modal-body button img {
      vertical-align: middle;
      margin-right: 6px;
      font-size: 1.3em;
    }

<style>
  /* Compact lock sizing (hard overrides) */
  .locks-grid{
    grid-template-columns: repeat(auto-fit, minmax(88px, 1fr)) !important;
    gap: 8px !important;
  }

  .locks-grid .lock-btn{
    --lock-size: 56px;   /* dial this to taste */
    --ring: 2px;
    width: var(--lock-size) !important;     /* key: constrain the button box */
    padding: 4px 0 !important;
    gap: 4px !important;
    justify-self: center;
  }

  .locks-grid .lock-btn::before{
    font-size: 1rem !important;
    box-shadow: 0 3px 8px rgba(0,0,0,0.18) !important;
  }

  /* tie the SVG lock graphic to the circle size instead of % of button */
  .locks-grid .lock-btn::after{
    width: calc(var(--lock-size) * 0.62) !important;
    height: calc(var(--lock-size) * 0.62) !important;
    top: calc(var(--lock-size) * 0.20) !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
  }

  .locks-grid .lock-btn .lock-label{
    font-size: 0.8rem !important;
    padding: 3px 6px !important;
  }

  /* tiny on phones */
  @media (max-width: 480px){
    .locks-grid .lock-btn{ --lock-size: 50px; }
  }
</style>

  </style>
</head>
<body>

  <header>
    <div class="title-row">
      <img src="../pictures/lionClipArt/pumpkinLion.png" alt="Lion Icon 1" />
      <h1>LRC Week 9 - Spooky Stories!</h1>
      <img src="../pictures/lionClipArt/pumpkinLion.png" alt="Lion Icon 2" />
    </div>
  </header>

  <!-- Timer toggle -->
  <div class="top-controls">
    <label class="toggle">
      <input type="checkbox" id="timerToggle" checked>
      <span>‚è± Timers: On</span>
    </label>
  </div>

  <!-- ===== Must Do as locks (ONLY TWO) ===== -->
  <section>
    <h2>üìå Must Do</h2>
    <div class="locks-grid" id="locksGrid" aria-label="Must Do steps">
      <button id="task-1" class="lock-btn locked" data-step="1" data-modal="modal3" aria-label="Step 1: Main Activity (locked)">
        <span class="lock-label">Main Activity</span>
      </button>
      <button id="task-2" class="lock-btn locked" data-step="2" data-modal="modal5" aria-label="Step 2: Works of Choice (locked)">
        <span class="lock-label">Works of Choice</span>
      </button>
    </div>
    <p class="locks-hint">Complete steps in order. Click a green lock to begin.</p>
  </section>

  <!-- ===== MODALS (ONLY THE TWO YOU WANTED) ===== -->

  <!-- Main Activity -->
  <div id="modal3" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal3-title" data-duration="900">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal3-title">Main Activity</h3>
        <div class="timer-wrap">
          <div class="timer-label"><span id="time-modal3">15:00</span></div>
          <div class="timer-bar"><div id="bar-modal3" class="timer-fill"></div></div>
        </div>
        <span class="close" onclick="closeModal('modal3')" aria-label="Close">&times;</span>
      </div>
      <div class="modal-body">
        <iframe src="../events/pumpkinPatch/pumpkinPatchVotingModal.html" allowfullscreen></iframe>
      </div>
    </div>
  </div>

  <!-- Works of Choice -->
 <!-- Works of Choice (open in new tab) -->
<a id="works-of-choice-link"
   href="https://docs.google.com/presentation/d/e/2PACX-1vTw3jGeCiIxt4sfi2XnDB3HBziqw2IaSz392_Es-gT8sYIitloQ__Bd5rejBv9REgA550ZZ1_E-d6rY/pub?start=true&loop=true&delayms=3000"
   target="_blank"
   rel="noopener noreferrer"
   style="display:none;">Works of Choice</a>

  </div>

  <section class="hidden">
    <h2>üéØ Objectives</h2>
    <div class="objectives">
      <div>
        <strong>I Can Statements:</strong>
        <ul>
          <li>I can [skill statement #1].</li>
          <li>I can [skill statement #2].</li>
        </ul>
      </div>
      <div>
        <strong>Standards:</strong>
        <ul>
          <li>ISTE 1.1.b ‚Äì Empowered Learner</li>
          <li>AISLE 1B.1.3 ‚Äì Demonstrate responsible use of technology</li>
        </ul>
      </div>
    </div>
  </section>

  <script>
    // ===== Config =====
    const AUTO_COMPLETE_ON_TIMEOUT = false; // set true if you want tasks to auto-complete when timers end

    // ===== State / helpers =====
    const timers = {}; // modalId -> {interval, remaining, total}
    function formatTime(s) {
      s = Math.max(0, Math.floor(s));
      const m = Math.floor(s / 60);
      const sec = s % 60;
      return `${m}:${sec.toString().padStart(2, '0')}`;
    }

    function startTimer(modalId) {
      const toggle = document.getElementById('timerToggle');
      const useTimers = toggle && toggle.checked;
      const modal = document.getElementById(modalId);
      if (!modal) return;

      const total = Number(modal.getAttribute('data-duration') || 0);
      const timeEl = document.getElementById(`time-${modalId}`);
      const barEl = document.getElementById(`bar-${modalId}`);

      // If timers off or no duration, clear visuals and exit
      if (!useTimers || !total || !timeEl || !barEl) {
        if (timeEl) timeEl.textContent = '';
        if (barEl) barEl.style.width = '0%';
        return;
      }

      if (timers[modalId]) clearInterval(timers[modalId].interval);
      timers[modalId] = { remaining: total, total, interval: null };

      // Initial draw
      timeEl.textContent = formatTime(total);
      barEl.style.width = '0%';

      timers[modalId].interval = setInterval(() => {
        const t = timers[modalId];
        if (!t) return;
        t.remaining -= 1;

        const pct = Math.min(100, ((t.total - t.remaining) / t.total) * 100);
        barEl.style.width = pct + '%';
        timeEl.textContent = formatTime(t.remaining);

        if (t.remaining <= 0) {
          clearInterval(t.interval);
          if (AUTO_COMPLETE_ON_TIMEOUT && window.currentModal === modalId) {
            const taskId = findTaskByModal(modalId);
            if (taskId) { markCompleted(taskId); }
            closeModal(modalId);
          } else {
            timeEl.textContent = 'Time‚Äôs up';
          }
        }
      }, 1000);
    }

    function stopTimer(modalId) {
      const t = timers[modalId];
      if (t && t.interval) clearInterval(t.interval);
      delete timers[modalId];
    }

    function findTaskByModal(modalId) {
      const el = document.querySelector(`.lock-btn[data-modal="${modalId}"]`);
      return el ? el.id : null;
    }

    // ===== Modal controls =====
    function openModal(id) {
      const el = document.getElementById(id);
      if (!el) return;
      el.style.display = "block";
      window.currentModal = id;

      // focus close for keyboard users
      const closeBtn = el.querySelector('.close');
      if (closeBtn) closeBtn.focus();

      startTimer(id);
    }

    function closeModal(id) {
      const el = document.getElementById(id);
      if (!el) return;
      el.style.display = "none";
      if (window.currentModal === id) window.currentModal = null;
      stopTimer(id);
    }

    // ===== Locks logic (ONLY TWO TASKS) =====
    function updateTaskLocks() {
      const order = ['task-1','task-2'];
      order.forEach((id, idx) => {
        const btn = document.getElementById(id);
        if (!btn) return;

        const done = btn.classList.contains('completed');
        const prereqsDone = order.slice(0, idx).every(tid => {
          const el = document.getElementById(tid);
          return el && el.classList.contains('completed');
        });

        btn.classList.remove('locked','unlocked');
        if (done) {
          // keep .completed
        } else if (idx === 0 || prereqsDone) {
          btn.classList.add('unlocked');
          btn.setAttribute('aria-label', `Step ${idx+1}: ${btn.querySelector('.lock-label')?.textContent || ''} (ready)`);
        } else {
          btn.classList.add('locked');
          btn.setAttribute('aria-label', `Step ${idx+1}: ${btn.querySelector('.lock-label')?.textContent || ''} (locked)`);
        }
      });
    }

function openModalFromTask(taskId) {
  const order = ['task-1','task-2'];
  const idx = order.indexOf(taskId);
  if (idx < 0) return;

  const btn = document.getElementById(taskId);
  if (!btn || btn.classList.contains('locked')) return;

  // For Works of Choice, open in new tab
  if (taskId === 'task-2') {
    window.open(
      'https://docs.google.com/presentation/d/e/2PACX-1vTw3jGeCiIxt4sfi2XnDB3HBziqw2IaSz392_Es-gT8sYIitloQ__Bd5rejBv9REgA550ZZ1_E-d6rY/pub?start=true&loop=true&delayms=6000',
      '_blank'
    );
    markCompleted('task-2');
    return;
  }

  // Default modal behavior for the first lock
  const modalId = btn.getAttribute('data-modal');
  window.lastOpenedTaskId = taskId;
  openModal(modalId);
}

    function markCompleted(taskId) {
      const btn = document.getElementById(taskId);
      if (btn) {
        btn.classList.add('completed');
        btn.classList.remove('locked','unlocked');
      }
      updateTaskLocks();
    }

    // ===== Event wiring =====
    window.addEventListener('DOMContentLoaded', () => {
      // Reset locks to initial state and wire clicks
      document.querySelectorAll('.lock-btn').forEach(btn => {
        btn.classList.remove('completed','unlocked'); // start locked; update will unlock #1
        btn.addEventListener('click', () => openModalFromTask(btn.id));
      });
      updateTaskLocks();

      // Timer toggle label + live restart
      const toggle = document.getElementById('timerToggle');
      if (toggle) {
        const span = toggle.parentElement.querySelector('span');
        const setLabel = () => span.textContent = `‚è± Timers: ${toggle.checked ? 'On' : 'Off'}`;
        setLabel();
        toggle.addEventListener('change', () => {
          setLabel();
          if (window.currentModal) {
            stopTimer(window.currentModal);
            startTimer(window.currentModal);
          }
        });
      }
    });

    // Click backdrop to close
    window.addEventListener('click', function(event) {
      const modals = document.querySelectorAll('.modal');
      modals.forEach(modal => {
        if (event.target === modal) {
          closeModal(modal.id);
        }
      });
    });

    // ESC to close
    window.addEventListener('keydown', function(event) {
      if (event.key === 'Escape' && window.currentModal) {
        closeModal(window.currentModal);
      }
    });

    // Optional: allow embedded activities to signal completion
    // In your iframe content, postMessage('activityComplete', '*') to auto-complete and close.
    window.addEventListener('message', function(event) {
      if (event.data === 'activityComplete' && window.currentModal) {
        const taskId = findTaskByModal(window.currentModal);
        if (taskId) markCompleted(taskId);
        closeModal(window.currentModal);
        window.lastOpenedTaskId = null;
      }
    });
  </script>
</body>
</html>
