<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Grade [X] Weekly Tech Lesson</title>
  <style>
    body {
      font-family: 'Comic Sans MS', Arial, Helvetica, sans-serif;
      background: url('./pictures/otherIcons/backgroundJungle.png') no-repeat center center fixed;
      background-size: cover;
      color: #2e3d2f;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
      background-color: rgba(255, 255, 255, 0.8);
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 6px 12px rgba(0,0,0,0.2);
    }

    header .title-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 28px;
      flex-wrap: wrap;
    }

    header img { width: 75px; height: 75px; }
    @media (max-width: 520px) {
      header img { width: 75px; height: 75px; }
    }

    header h1 { font-size: 2.5em; color: #2e3d2f; margin: 0; }

    section {
      background-color: rgba(255, 255, 255, 0.9);
      border-radius: 12px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
      padding: 20px;
      margin-bottom: 10px;
    }

    h2 { color: #4f6f52; margin-bottom: 10px; }

    a img:hover { transform: scale(1.05); transition: transform 0.2s; }

    /* ===== Top controls (timer toggle) ===== */
    .top-controls {
      display: flex;
      align-items: center;
      gap: 12px;
      justify-content: flex-end;
      margin-bottom: -8px;
    }
    .toggle {
      display: inline-flex; align-items: center; gap: 6px;
      background: rgba(255,255,255,0.9);
      border: 1px solid #e6eddc; border-radius: 8px; padding: 6px 10px;
    }

    /* ===== Locks UI ===== */
    .locks-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 14px;
      align-items: start;
    }

    .lock-btn {
      --lock-size: 90px;
      --ring: 3px;
      --text: #2e3d2f;
      position: relative;
      background: transparent;
      border: none;
      cursor: default;
      display: grid;
      justify-items: center;
      align-items: center;
      gap: 8px;
      padding: 10px 6px;
      border-radius: 12px;
    }

    .lock-btn:focus-visible {
      outline: 3px solid #7c9a63;
      outline-offset: 2px;
      border-radius: 14px;
    }

    .lock-btn::before {
      content: attr(data-step);
      width: var(--lock-size);
      height: var(--lock-size);
      border-radius: 999px;
      display: grid;
      place-items: center;
      font-weight: 900;
      font-size: 1.6rem;
      color: #fff;
      box-shadow: 0 6px 14px rgba(0,0,0,0.25);
    }

    .lock-btn .lock-label {
      font-size: 0.95rem;
      text-align: center;
      color: var(--text);
      background: rgba(255,255,255,0.85);
      padding: 6px 10px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.12);
    }

    .lock-btn::after {
      content: "";
      position: absolute;
      width: 54%;
      aspect-ratio: 1/1;
      top: 22%;
      left: 50%;
      transform: translateX(-50%);
      background-repeat: no-repeat;
      background-position: center;
      background-size: contain;
      filter: drop-shadow(0 2px 2px rgba(0,0,0,0.25));
    }

    /* Locked (grey, closed) */
    .lock-btn.locked::before {
      background: linear-gradient(145deg, #cbd5c2, #9eaa9e);
      border: var(--ring) solid #e6eddc;
    }
    .lock-btn.locked { cursor: not-allowed; }
    .lock-btn.locked::after {
      background-image: url("data:image/svg+xml;utf8,\
      <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'>\
        <g fill='none' stroke='%23808c80' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'>\
          <rect x='12' y='28' width='40' height='28' rx='6' fill='%23dfe6da'/>\
          <path d='M20 28v-8a12 12 0 0 1 24 0v8'/>\
        </g></svg>");
    }

    /* Unlocked/Ready (green, open) */
    .lock-btn.unlocked { cursor: pointer; }
    .lock-btn.unlocked::before {
      background: linear-gradient(145deg, #7ccf8f, #3fa35b);
      border: var(--ring) solid #e6f5e9;
    }
    .lock-btn.unlocked:hover::before {
      transform: translateY(-2px);
      transition: transform 120ms ease;
    }
    .lock-btn.unlocked::after {
      background-image: url("data:image/svg+xml;utf8,\
      <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'>\
        <g fill='none' stroke='%232b8a46' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'>\
          <rect x='12' y='28' width='40' height='28' rx='6' fill='%23d9f5e1'/>\
          <path d='M24 20a12 12 0 0 1 24 0v0'/>\
          <path d='M24 20c0-6.6 5.4-12 12-12'/>\
        </g></svg>");
    }

    /* Completed (green with check) */
    .lock-btn.completed::before {
      background: linear-gradient(145deg, #7ccf8f, #3fa35b);
      border: var(--ring) solid #e6f5e9;
      content: "‚úì";
      font-size: 2rem;
    }
    .lock-btn.completed::after { display: none; }

    .locks-hint {
      margin-top: 8px;
      color: #4f6f52;
      font-size: 0.95rem;
    }

    /* ===== Modal ===== */
    .modal {
      display: none; position: fixed; z-index: 1000; inset: 0;
      width: 100vw; height: 100vh; background-color: rgba(0,0,0,0.6);
    }
    .modal-content {
      position: absolute; inset: 0; background-color: #fefefe;
      border: 2px solid #7c9a63; border-radius: 0; box-shadow: 0 10px 25px rgba(0,0,0,0.3);
      display: flex; flex-direction: column; box-sizing: border-box;
    }
    .modal-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 12px 18px; border-bottom: 1px solid #e2e2e2; background: #ffffff; gap: 12px;
    }
    .modal-header h3 { margin: 0; color: #2e3d2f; }
    .close { color: #333; font-size: 28px; font-weight: bold; cursor: pointer; line-height: 1; padding: 4px 10px; border-radius: 6px; }
    .close:hover { background: #f0f0f0; }
    .modal-body { flex: 1 1 auto; display: flex; min-height: 0; }
    .modal-body iframe { width: 100%; height: 100%; border: 0; }

    /* Timer bar */
    .timer-wrap { flex: 0 0 auto; width: 210px; }
    .timer-label { font-size: 0.8rem; color: #4f6f52; }
    .timer-bar { width: 100%; height: 8px; background: #e6eddc; border-radius: 6px; overflow: hidden; }
    .timer-fill { height: 100%; width: 0%; background: #7c9a63; transition: width 1s linear; }
  </style>
</head>
<body>

  <header>
    <div class="title-row">
      <img src="./pictures/lionClipArt/lionBook.png" alt="Lion Icon 1" />
      <h1>LRC Week 9 - Spooky Stories!
      <img src="./pictures/lionClipArt/lionLaptop.png" alt="Lion Icon 2" />
    </div>
  </header>

  <!-- Timer toggle -->
  <div class="top-controls">
    <label class="toggle">
      <input type="checkbox" id="timerToggle" checked>
      <span>‚è± Timers: On</span>
    </label>
  </div>

  <!-- ===== Must Do as locks ===== -->
  <section>
    <h2>üìå Must Do</h2>
    <div class="locks-grid" id="locksGrid" aria-label="Must Do steps">
      <button id="task-1" class="lock-btn locked" data-step="1" data-modal="modal1" aria-label="Step 1: Typing Warm-Up (locked)">
        <span class="lock-label">Typing Warm-Up</span>
      </button>
      <button id="task-2" class="lock-btn locked" data-step="2" data-modal="modal4" aria-label="Step 2: Book Checkout (locked)">
        <span class="lock-label">Book Checkout</span>
      </button>
      <button id="task-3" class="lock-btn locked" data-step="3" data-modal="modal2" aria-label="Step 3: Instructions (locked)">
        <span class="lock-label">Instructions</span>
      </button>
      <button id="task-4" class="lock-btn locked" data-step="4" data-modal="modal3" aria-label="Step 4: Main Activity (locked)">
        <span class="lock-label">Main Activity</span>
      </button>
      <button id="task-5" class="lock-btn locked" data-step="5" data-modal="modal5" aria-label="Step 5: Works of Choice (locked)">
        <span class="lock-label">Works of Choice</span>
      </button>
    </div>
    <p class="locks-hint">Complete steps in order. Click a green lock to begin.</p>
  </section>

  <!-- ===== MODALS ===== -->

  <!-- 1Ô∏è‚É£ Typing Warm-Up -->
  <div id="modal1" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal1-title" data-duration="300">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal1-title">Typing Warm-Up</h3>
        <div class="timer-wrap">
          <div class="timer-label"><span id="time-modal1">5:00</span></div>
          <div class="timer-bar"><div id="bar-modal1" class="timer-fill"></div></div>
        </div>
        <span class="close" onclick="closeModal('modal1')" aria-label="Close">&times;</span>
      </div>
      <div class="modal-body">
        <!-- üîó Replace with your typing activity link -->
        <iframe src="./typingWarmUp.html" allowfullscreen></iframe>
      </div>
    </div>
  </div>

  <!-- 2Ô∏è‚É£ Book Checkout -->
  <div id="modal4" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal4-title" data-duration="420">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal4-title">üìö Book Checkout</h3>
        <div class="timer-wrap">
          <div class="timer-label"><span id="time-modal4">7:00</span></div>
          <div class="timer-bar"><div id="bar-modal4" class="timer-fill"></div></div>
        </div>
        <span class="close" onclick="closeModal('modal4')" aria-label="Close">&times;</span>
      </div>
      <div class="modal-body" style="flex-direction:column; padding:16px; gap:16px;">
        <ol>
          <li>Quietly choose <strong>1‚Äì2 books</strong> you‚Äôre excited to read.</li>
          <li>Use <em>Destiny Discover</em> if you need help finding a book.</li>
          <li>Treat books with care and check out at the desk.</li>
        </ol>
        <!-- üîó Replace with your Destiny Discover URL if different -->
        <iframe src="./destiny.html" style="flex:1;"></iframe>
        <button onclick="markCompleted('task-2'); closeModal('modal4')">I‚Äôm done ‚Äî books checked out!</button>
      </div>
    </div>
  </div>

  <!-- 3Ô∏è‚É£ Instructions -->
  <div id="modal2" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal2-title" data-duration="180">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal2-title">Instructions</h3>
        <div class="timer-wrap">
          <div class="timer-label"><span id="time-modal2">3:00</span></div>
          <div class="timer-bar"><div id="bar-modal2" class="timer-fill"></div></div>
        </div>
        <span class="close" onclick="closeModal('modal2')" aria-label="Close">&times;</span>
      </div>
      <div class="modal-body" style="flex-direction:column; padding:16px; gap:16px;">
        <p><strong>Watch this quick guide, then click ‚ÄúI‚Äôm ready.‚Äù</strong></p>
        <!-- üîó Use YouTube /embed/ link or Google Slides publish link -->
        <iframe src="https://www.youtube.com/embed/yourVideoID" allowfullscreen></iframe>
        <button onclick="markCompleted('task-3'); closeModal('modal2')">I‚Äôm ready ‚Äî I understand</button>
      </div>
    </div>
  </div>

  <!-- 4Ô∏è‚É£ Main Activity -->
  <div id="modal3" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal3-title" data-duration="900">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal3-title">Main Activity</h3>
        <div class="timer-wrap">
          <div class="timer-label"><span id="time-modal3">15:00</span></div>
          <div class="timer-bar"><div id="bar-modal3" class="timer-fill"></div></div>
        </div>
        <span class="close" onclick="closeModal('modal3')" aria-label="Close">&times;</span>
      </div>
      <div class="modal-body">
        <!-- üîó Replace with your activity page -->
        <iframe src="/worksOfChoice/jungleGames12/gameHub12Jungle.html" allowfullscreen></iframe>
      </div>
    </div>
  </div>

  <!-- 5Ô∏è‚É£ Works of Choice -->
  <div id="modal5" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal5-title" data-duration="600">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal5-title">üéâ Works of Choice</h3>
        <div class="timer-wrap">
          <div class="timer-label"><span id="time-modal5">10:00</span></div>
          <div class="timer-bar"><div id="bar-modal5" class="timer-fill"></div></div>
        </div>
        <span class="close" onclick="closeModal('modal5')" aria-label="Close">&times;</span>
      </div>
      <div class="modal-body" style="flex-direction:column; padding:16px; gap:16px;">
        <p>Pick an activity from the Works of Choice board! üé®üéÆüìñ</p>
        <!-- üîó Replace with your Choice Board link -->
        <a href="https://docs.google.com/presentation/d/yourChoiceBoardID/edit" target="_blank" rel="noopener">
          <img src="./pictures/otherIcons/worksChoice.png" alt="Works of Choice" style="max-width:320px; margin:auto; display:block;">
        </a>
        <div style="text-align:center; margin-top:12px;">
          <button onclick="markCompleted('task-5'); closeModal('modal5')">I‚Äôm done with Works of Choice</button>
        </div>
      </div>
    </div>
  </div>

  <section>
    <h2>üéØ Objectives</h2>
    <div class="objectives">
      <div>
        <strong>I Can Statements:</strong>
        <ul>
          <li>I can [skill statement #1].</li>
          <li>I can [skill statement #2].</li>
        </ul>
      </div>
      <div>
        <strong>Standards:</strong>
        <ul>
          <li>ISTE 1.1.b ‚Äì Empowered Learner</li>
          <li>AISLE 1B.1.3 ‚Äì Demonstrate responsible use of technology</li>
        </ul>
      </div>
    </div>
  </section>




  <script>
    // ===== Config =====
    const AUTO_COMPLETE_ON_TIMEOUT = false; // set true if you want tasks to auto-complete when timers end

    // ===== State / helpers =====
    const timers = {}; // modalId -> {interval, remaining, total}
    function formatTime(s) {
      s = Math.max(0, Math.floor(s));
      const m = Math.floor(s / 60);
      const sec = s % 60;
      return `${m}:${sec.toString().padStart(2, '0')}`;
    }

    function startTimer(modalId) {
      const toggle = document.getElementById('timerToggle');
      const useTimers = toggle && toggle.checked;
      const modal = document.getElementById(modalId);
      if (!modal) return;

      const total = Number(modal.getAttribute('data-duration') || 0);
      const timeEl = document.getElementById(`time-${modalId}`);
      const barEl = document.getElementById(`bar-${modalId}`);

      // If timers off or no duration, clear visuals and exit
      if (!useTimers || !total || !timeEl || !barEl) {
        if (timeEl) timeEl.textContent = '';
        if (barEl) barEl.style.width = '0%';
        return;
      }

      if (timers[modalId]) clearInterval(timers[modalId].interval);
      timers[modalId] = { remaining: total, total, interval: null };

      // Initial draw
      timeEl.textContent = formatTime(total);
      barEl.style.width = '0%';

      timers[modalId].interval = setInterval(() => {
        const t = timers[modalId];
        if (!t) return;
        t.remaining -= 1;

        const pct = Math.min(100, ((t.total - t.remaining) / t.total) * 100);
        barEl.style.width = pct + '%';
        timeEl.textContent = formatTime(t.remaining);

        if (t.remaining <= 0) {
          clearInterval(t.interval);
          if (AUTO_COMPLETE_ON_TIMEOUT && window.currentModal === modalId) {
            const taskId = findTaskByModal(modalId);
            if (taskId) { markCompleted(taskId); }
            closeModal(modalId);
          } else {
            timeEl.textContent = 'Time‚Äôs up';
          }
        }
      }, 1000);
    }

    function stopTimer(modalId) {
      const t = timers[modalId];
      if (t && t.interval) clearInterval(t.interval);
      delete timers[modalId];
    }

    function findTaskByModal(modalId) {
      const el = document.querySelector(`.lock-btn[data-modal="${modalId}"]`);
      return el ? el.id : null;
    }

    // ===== Modal controls =====
    function openModal(id) {
      const el = document.getElementById(id);
      if (!el) return;
      el.style.display = "block";
      window.currentModal = id;

      // focus close for keyboard users
      const closeBtn = el.querySelector('.close');
      if (closeBtn) closeBtn.focus();

      startTimer(id);
    }

    function closeModal(id) {
      const el = document.getElementById(id);
      if (!el) return;
      el.style.display = "none";
      if (window.currentModal === id) window.currentModal = null;
      stopTimer(id);
    }

    // ===== Locks logic =====
    function updateTaskLocks() {
      const order = ['task-1','task-2','task-3','task-4','task-5'];
      order.forEach((id, idx) => {
        const btn = document.getElementById(id);
        if (!btn) return;

        const done = btn.classList.contains('completed');
        const prereqsDone = order.slice(0, idx).every(tid => {
          const el = document.getElementById(tid);
          return el && el.classList.contains('completed');
        });

        btn.classList.remove('locked','unlocked');
        if (done) {
          // keep .completed
        } else if (idx === 0 || prereqsDone) {
          btn.classList.add('unlocked');
          btn.setAttribute('aria-label', `Step ${idx+1}: ${btn.querySelector('.lock-label')?.textContent || ''} (ready)`);
        } else {
          btn.classList.add('locked');
          btn.setAttribute('aria-label', `Step ${idx+1}: ${btn.querySelector('.lock-label')?.textContent || ''} (locked)`);
        }
      });
    }

    function openModalFromTask(taskId) {
      const order = ['task-1','task-2','task-3','task-4','task-5'];
      const idx = order.indexOf(taskId);
      if (idx < 0) return;

      const btn = document.getElementById(taskId);
      if (!btn || btn.classList.contains('locked')) return; // enforce sequence

      const modalId = btn.getAttribute('data-modal');
      window.lastOpenedTaskId = taskId;
      openModal(modalId);
    }

    function markCompleted(taskId) {
      const btn = document.getElementById(taskId);
      if (btn) {
        btn.classList.add('completed');
        btn.classList.remove('locked','unlocked');
      }
      updateTaskLocks();
    }

    // ===== Event wiring =====
    window.addEventListener('DOMContentLoaded', () => {
      // Reset locks to initial state and wire clicks
      document.querySelectorAll('.lock-btn').forEach(btn => {
        btn.classList.remove('completed','unlocked'); // start locked; update will unlock #1
        btn.addEventListener('click', () => openModalFromTask(btn.id));
      });
      updateTaskLocks();

      // Timer toggle label + live restart
      const toggle = document.getElementById('timerToggle');
      if (toggle) {
        const span = toggle.parentElement.querySelector('span');
        const setLabel = () => span.textContent = `‚è± Timers: ${toggle.checked ? 'On' : 'Off'}`;
        setLabel();
        toggle.addEventListener('change', () => {
          setLabel();
          if (window.currentModal) {
            stopTimer(window.currentModal);
            startTimer(window.currentModal);
          }
        });
      }
    });

    // Click backdrop to close
    window.addEventListener('click', function(event) {
      const modals = document.querySelectorAll('.modal');
      modals.forEach(modal => {
        if (event.target === modal) {
          closeModal(modal.id);
        }
      });
    });

    // ESC to close
    window.addEventListener('keydown', function(event) {
      if (event.key === 'Escape' && window.currentModal) {
        closeModal(window.currentModal);
      }
    });

    // Optional: allow embedded activities to signal completion
    // In your iframe content, postMessage('activityComplete', '*') to auto-complete and close.
    window.addEventListener('message', function(event) {
      if (event.data === 'activityComplete' && window.currentModal) {
        const taskId = findTaskByModal(window.currentModal);
        if (taskId) markCompleted(taskId);
        closeModal(window.currentModal);
        window.lastOpenedTaskId = null;
      }
    });
  </script>
</body>
</html>
