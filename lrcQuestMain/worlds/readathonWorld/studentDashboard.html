<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Read-a-Thon Student Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:#f4f6fb;
      margin:0;
      padding:18px;
    }
    .wrap{
      max-width: 980px;
      margin: 0 auto;
    }
    header{
      display:flex;
      flex-wrap:wrap;
      align-items:flex-end;
      justify-content:space-between;
      gap: 12px;
      margin-bottom: 14px;
    }
    h1{ margin:0; font-size: 1.55rem; }
    .sub{ color:#4b5563; font-size: .95rem; margin-top: 4px; }
    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 14px;
      margin-top: 14px;
    }
    .card{
      background:#fff;
      border-radius: 16px;
      box-shadow: 0 6px 14px rgba(0,0,0,.08);
      padding: 16px;
    }
    .card h2{ margin:0 0 10px 0; font-size: 1.05rem; }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:999px;
      background:#eef2ff;
      font-weight: 700;
    }
    .pill small{ font-weight: 600; color:#374151; }
    .btn{
      appearance:none;
      border:none;
      border-radius: 12px;
      padding: 10px 12px;
      font-weight: 700;
      cursor:pointer;
      background:#4f46e5;
      color:#fff;
      width:100%;
    }
    .btn.secondary{
      background:#111827;
    }
    .btn.ghost{
      background:#e5e7eb;
      color:#111827;
    }
    .btn:disabled{
      opacity:.55;
      cursor:not-allowed;
    }
    input, select{
      width:100%;
      padding:10px 12px;
      border:1px solid #d1d5db;
      border-radius: 12px;
      font-size: 1rem;
      box-sizing:border-box;
    }
    label{
      display:block;
      font-weight:700;
      margin: 10px 0 6px;
      color:#111827;
    }
    .muted{ color:#6b7280; font-size:.92rem; }
    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .row > *{ flex: 1 1 180px; }
    .tile{
      display:flex;
      flex-direction:column;
      gap:10px;
      height:100%;
    }
    .big-number{
      font-size: 2rem;
      font-weight: 900;
      letter-spacing: -0.02em;
    }
    .list{
      margin:0;
      padding:0;
      list-style:none;
      display:flex;
      flex-direction:column;
      gap:10px;
      max-height: 340px;
      overflow:auto;
    }
    .item{
      border:1px solid #e5e7eb;
      border-radius: 14px;
      padding: 10px 12px;
      background:#fafafa;
    }
    .item strong{ display:block; }
    .item .meta{ color:#6b7280; font-size:.9rem; margin-top:4px; }
    .split{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
    }
    .tag{
      font-size:.78rem;
      font-weight:800;
      padding:6px 10px;
      border-radius:999px;
      background:#dcfce7;
      color:#14532d;
      white-space:nowrap;
    }
    .tag.purchase{
      background:#ffedd5;
      color:#7c2d12;
    }
    .footer-tools{
      margin-top: 14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .footer-tools button{
      flex: 1 1 200px;
    }
    /* Layout */
    .col-8{ grid-column: span 8; }
    .col-4{ grid-column: span 4; }
    .col-6{ grid-column: span 6; }
    .col-12{ grid-column: span 12; }

    @media (max-width: 860px){
      .col-8,.col-4,.col-6{ grid-column: span 12; }
      header{ align-items:flex-start; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>üìö Read-a-Thon Student Dashboard</h1>
        <div class="sub">Log your reading, check your balance, and shop prizes.</div>
      </div>

      <div class="pill">
        <small>Balance</small>
        <span><span id="currency">0</span> <span id="currencyLabel">Sparks</span> ‚ú®</span>
      </div>
    </header>

    <div class="grid">

      <!-- Welcome / Name -->
      <section class="card col-6">
        <div class="tile">
          <h2>üëã Welcome</h2>
          <div class="muted">Type your name once. This device will remember it.</div>

          <label for="studentName">Student Name</label>
          <input id="studentName" placeholder="Example: Sam R." maxlength="40" />

          <button class="btn ghost" id="saveNameBtn">Save Name</button>
          <div class="muted" id="nameStatus"></div>
        </div>
      </section>

      <!-- Quick Actions -->
      <section class="card col-6">
        <div class="tile">
          <h2>‚ö° Quick Actions</h2>

          <button class="btn" id="openStoreBtn">Open Prize Store</button>
          <button class="btn secondary" id="viewPurchasesBtn">View My Purchases</button>

          <div class="muted">Tip: You can buy multiple prizes in one visit.</div>
        </div>
      </section>

      <!-- Log Reading -->
      <section class="card col-6">
        <div class="tile">
          <h2>‚è±Ô∏è Log Reading</h2>
          <div class="muted">1 minute = 1 <span id="currencyLabel2">Sparks</span>. You can log multiple times per day.</div>

          <div class="row">
            <div>
              <label for="minutes">Minutes Read</label>
              <input id="minutes" type="number" min="1" max="999" inputmode="numeric" placeholder="e.g., 15" />
            </div>
            <div>
              <label for="note">Optional Note</label>
              <input id="note" placeholder="Book / where you read (optional)" maxlength="80" />
            </div>
          </div>

          <button class="btn" id="logBtn">Add Minutes</button>

          <div class="muted" id="logStatus"></div>
        </div>
      </section>

      <!-- Progress Snapshot -->
      <section class="card col-6">
        <div class="tile">
          <h2>üìà Progress Snapshot</h2>

          <div class="split">
            <div>
              <div class="muted">Total Minutes Logged</div>
              <div class="big-number" id="totalMinutes">0</div>
            </div>
            <div>
              <div class="muted">Total Purchases</div>
              <div class="big-number" id="totalPurchases">0</div>
            </div>
          </div>

          <div class="muted">Your balance updates instantly when you log minutes or buy prizes.</div>
        </div>
      </section>

      <!-- Activity Feed -->
      <section class="card col-12">
        <div class="tile">
          <h2>üßæ Recent Activity</h2>
          <div class="muted">Reading logs + purchases (newest first).</div>
          <ul class="list" id="activity"></ul>
        </div>
      </section>

    </div>

    <div class="footer-tools">
      <button class="btn ghost" id="addTestBtn">+50 Sparks (Test)</button>
      <button class="btn ghost" id="resetBtn">Reset This Device</button>
    </div>

  </div>

<script>
  // ----------------------------
  // CONFIG
  // ----------------------------
  const CURRENCY_LABEL = "Sparks";

  // Change this if you keep pages in the same folder:
  const PRIZE_STORE_URL = "prizeStore.html";

  // ----------------------------
  // STORAGE KEYS
  // ----------------------------
  const KEY_CURRENCY = "currency";
  const KEY_PURCHASES = "purchases";
  const KEY_READING = "readingLogs";
  const KEY_NAME = "studentName";

  // ----------------------------
  // STATE
  // ----------------------------
  let currency = Number(localStorage.getItem(KEY_CURRENCY)) || 0;
  let purchases = JSON.parse(localStorage.getItem(KEY_PURCHASES) || "[]");
  let readingLogs = JSON.parse(localStorage.getItem(KEY_READING) || "[]");
  let studentName = localStorage.getItem(KEY_NAME) || "";

  // ----------------------------
  // DOM
  // ----------------------------
  const elCurrency = document.getElementById("currency");
  const elCurrencyLabel = document.getElementById("currencyLabel");
  const elCurrencyLabel2 = document.getElementById("currencyLabel2");

  const elName = document.getElementById("studentName");
  const elSaveNameBtn = document.getElementById("saveNameBtn");
  const elNameStatus = document.getElementById("nameStatus");

  const elMinutes = document.getElementById("minutes");
  const elNote = document.getElementById("note");
  const elLogBtn = document.getElementById("logBtn");
  const elLogStatus = document.getElementById("logStatus");

  const elTotalMinutes = document.getElementById("totalMinutes");
  const elTotalPurchases = document.getElementById("totalPurchases");
  const elActivity = document.getElementById("activity");

  const elOpenStoreBtn = document.getElementById("openStoreBtn");
  const elViewPurchasesBtn = document.getElementById("viewPurchasesBtn");

  const elAddTestBtn = document.getElementById("addTestBtn");
  const elResetBtn = document.getElementById("resetBtn");

  // ----------------------------
  // HELPERS
  // ----------------------------
  function saveAll(){
    localStorage.setItem(KEY_CURRENCY, String(currency));
    localStorage.setItem(KEY_PURCHASES, JSON.stringify(purchases));
    localStorage.setItem(KEY_READING, JSON.stringify(readingLogs));
    localStorage.setItem(KEY_NAME, studentName);
  }

  function formatTime(iso){
    try{
      const d = new Date(iso);
      return d.toLocaleString([], { year:"numeric", month:"short", day:"numeric", hour:"numeric", minute:"2-digit" });
    }catch{
      return iso;
    }
  }

  function sanitizeText(s){
    return String(s || "").replace(/[<>]/g, "");
  }

  // ----------------------------
  // RENDER
  // ----------------------------
  function render(){
    elCurrency.textContent = currency;
    elCurrencyLabel.textContent = CURRENCY_LABEL;
    elCurrencyLabel2.textContent = CURRENCY_LABEL;

    elName.value = studentName;

    // Totals
    const totalMinutes = readingLogs.reduce((sum, r) => sum + (Number(r.minutes) || 0), 0);
    elTotalMinutes.textContent = totalMinutes;

    elTotalPurchases.textContent = purchases.length;

    // Activity feed
    const activity = [];

    // Reading logs
    readingLogs.forEach(r => activity.push({
      type: "reading",
      title: `+${r.minutes} ${CURRENCY_LABEL}`,
      detail: r.note ? `Note: ${r.note}` : "Reading logged",
      time: r.time
    }));

    // Purchases (from store)
    purchases.forEach(p => activity.push({
      type: "purchase",
      title: `Purchased: ${p.name}`,
      detail: `-${p.cost} ${CURRENCY_LABEL}`,
      time: p.time
    }));

    activity.sort((a,b) => new Date(b.time) - new Date(a.time));

    elActivity.innerHTML = "";

    if(activity.length === 0){
      const li = document.createElement("li");
      li.className = "item";
      li.innerHTML = `<strong>No activity yet</strong><div class="meta">Log minutes to earn ${CURRENCY_LABEL}, then buy prizes.</div>`;
      elActivity.appendChild(li);
      return;
    }

    activity.slice(0, 30).forEach(a => {
      const li = document.createElement("li");
      li.className = "item";

      const tagClass = a.type === "purchase" ? "tag purchase" : "tag";
      const tagText = a.type === "purchase" ? "PURCHASE" : "READING";

      li.innerHTML = `
        <div class="split">
          <div>
            <strong>${sanitizeText(a.title)}</strong>
            <div class="meta">${sanitizeText(a.detail)}</div>
            <div class="meta">${formatTime(a.time)}</div>
          </div>
          <div class="${tagClass}">${tagText}</div>
        </div>
      `;

      elActivity.appendChild(li);
    });
  }

  // ----------------------------
  // ACTIONS
  // ----------------------------
  elSaveNameBtn.addEventListener("click", () => {
    const name = sanitizeText(elName.value).trim();
    studentName = name;
    saveAll();
    elNameStatus.textContent = name ? `Saved as "${name}".` : "Name cleared.";
    setTimeout(() => elNameStatus.textContent = "", 1800);
    render();
  });

  elLogBtn.addEventListener("click", () => {
    const minutes = Number(elMinutes.value);

    if(!Number.isFinite(minutes) || minutes < 1){
      elLogStatus.textContent = "Please enter minutes (at least 1).";
      return;
    }

    const note = sanitizeText(elNote.value).trim();

    // 1 minute = 1 currency
    currency += minutes;

    readingLogs.push({
      minutes,
      note,
      time: new Date().toISOString(),
      studentName: studentName || ""
    });

    saveAll();

    elMinutes.value = "";
    elNote.value = "";
    elLogStatus.textContent = `Added ${minutes} minutes ‚Üí +${minutes} ${CURRENCY_LABEL}.`;
    setTimeout(() => elLogStatus.textContent = "", 2200);

    render();
  });

  elOpenStoreBtn.addEventListener("click", () => {
    window.location.href = PRIZE_STORE_URL;
  });

  elViewPurchasesBtn.addEventListener("click", () => {
    const count = purchases.length;

    if(count === 0){
      alert("You haven‚Äôt purchased anything yet. Open the Prize Store when you‚Äôre ready!");
      return;
    }

    const lines = purchases
      .slice()
      .sort((a,b) => new Date(b.time) - new Date(a.time))
      .slice(0, 50)
      .map(p => `‚Ä¢ ${p.name} (-${p.cost} ${CURRENCY_LABEL})`);

    alert(`My Purchases (${count})\n\n${lines.join("\n")}`);
  });

  elAddTestBtn.addEventListener("click", () => {
    currency += 50;
    saveAll();
    render();
  });

  elResetBtn.addEventListener("click", () => {
    const ok = confirm("Reset this device? This clears name, currency, logs, and purchases on THIS browser only.");
    if(!ok) return;
    localStorage.removeItem(KEY_CURRENCY);
    localStorage.removeItem(KEY_PURCHASES);
    localStorage.removeItem(KEY_READING);
    localStorage.removeItem(KEY_NAME);

    currency = 0;
    purchases = [];
    readingLogs = [];
    studentName = "";

    render();
    alert("Reset complete.");
  });

  // ----------------------------
  // INIT
  // ----------------------------
  render();
</script>
</body>
</html>
